/*! For license information please see extension.js.LICENSE.txt */
(()=>{var e={8546:e=>{"use strict";function t(e){if(!(this instanceof t))return new t(e);this._=e}var n=t.prototype;function r(e,t){for(var n=0;n<e;n++)t(n)}function i(e,t,n){return function(e,t){r(t.length,(function(n){e(t[n],n,t)}))}((function(n,r,i){t=e(t,n,r,i)}),n),t}function o(e,t){return i((function(t,n,r,i){return t.concat([e(n,r,i)])}),[],t)}function a(e){var t=i((function(e,t,n,r){return e.concat(n===r.length-1?Buffer.from([t,0]).readUInt16BE(0):r.readUInt16BE(n))}),[],e);return Buffer.from(o((function(e){return(e<<1&65535)>>8}),t))}function s(e){return e[0]>>7}function u(){return"undefined"!=typeof Buffer}function c(){if(!u())throw new Error("Buffer global does not exist; please use webpack if you need to parse Buffers in the browser.")}function l(e){c();var n=i((function(e,t){return e+t}),0,e);if(n%8!=0)throw new Error("The bits ["+e.join(", ")+"] add up to "+n+" which is not an even number of bytes; the total should be divisible by 8");var o,u=n/8,l=(o=function(e){return e>48},i((function(e,t){return e||(o(t)?t:e)}),null,e));if(l)throw new Error(l+" bit range requested exceeds 48 bit (6 byte) Number max.");return new t((function(t,n){var o=u+n;return o>t.length?O(n,u.toString()+" bytes"):w(o,i((function(e,t){var n=function(e,t){var n={v:0,buf:t};return r(e,(function(){n={v:n.v<<1|s(n.buf),buf:a(n.buf)}})),n}(t,e.buf);return{coll:e.coll.concat(n.v),buf:n.buf}}),{coll:[],buf:t.slice(n,o)},e).coll)}))}function f(e,n){return new t((function(t,r){return c(),r+n>t.length?O(r,n+" bytes for "+e):w(r+n,t.slice(r,r+n))}))}function d(e,t){if("number"!=typeof(n=t)||Math.floor(n)!==n||t<0||t>6)throw new Error(e+" requires integer length in range [0, 6].");var n}function p(e){return d("uintBE",e),f("uintBE("+e+")",e).map((function(t){return t.readUIntBE(0,e)}))}function h(e){return d("uintLE",e),f("uintLE("+e+")",e).map((function(t){return t.readUIntLE(0,e)}))}function g(e){return d("intBE",e),f("intBE("+e+")",e).map((function(t){return t.readIntBE(0,e)}))}function v(e){return d("intLE",e),f("intLE("+e+")",e).map((function(t){return t.readIntLE(0,e)}))}function y(e){return Array.prototype.slice.call(e)}function m(e){return e instanceof t}function _(e){return"[object Array]"==={}.toString.call(e)}function b(e){return u()&&Buffer.isBuffer(e)}function w(e,t){return{status:!0,index:e,value:t,furthest:-1,expected:[]}}function O(e,t){return _(t)||(t=[t]),{status:!1,index:-1,value:null,furthest:e,expected:t}}function x(e,n){if(!n)return e;if(e.furthest>n.furthest)return e;var r=e.furthest===n.furthest?function(e,n){if(function(){if(void 0!==t._supportsSet)return t._supportsSet;var e="undefined"!=typeof Set;return t._supportsSet=e,e}()&&Array.from){for(var r=new Set(e),i=0;i<n.length;i++)r.add(n[i]);var o=Array.from(r);return o.sort(),o}for(var a={},s=0;s<e.length;s++)a[e[s]]=!0;for(var u=0;u<n.length;u++)a[n[u]]=!0;var c=[];for(var l in a)({}).hasOwnProperty.call(a,l)&&c.push(l);return c.sort(),c}(e.expected,n.expected):n.expected;return{status:e.status,index:e.index,value:e.value,furthest:n.furthest,expected:r}}var j={};function P(e,t){if(b(e))return{offset:t,line:-1,column:-1};e in j||(j[e]={});for(var n=j[e],r=0,i=0,o=0,a=t;a>=0;){if(a in n){r=n[a].line,0===o&&(o=n[a].lineStart);break}("\n"===e.charAt(a)||"\r"===e.charAt(a)&&"\n"!==e.charAt(a+1))&&(i++,0===o&&(o=a+1)),a--}var s=r+i,u=t-o;return n[t]={line:s,lineStart:o},{offset:t,line:s+1,column:u+1}}function E(e){if(!m(e))throw new Error("not a parser: "+e)}function I(e,t){return"string"==typeof e?e.charAt(t):e[t]}function k(e){if("number"!=typeof e)throw new Error("not a number: "+e)}function T(e){if(!(e instanceof RegExp))throw new Error("not a regexp: "+e);for(var t=A(e),n=0;n<t.length;n++){var r=t.charAt(n);if("i"!==r&&"m"!==r&&"u"!==r&&"s"!==r)throw new Error('unsupported regexp flag "'+r+'": '+e)}}function S(e){if("function"!=typeof e)throw new Error("not a function: "+e)}function D(e){if("string"!=typeof e)throw new Error("not a string: "+e)}function C(e,t){return new Array(t+1).join(e)}function M(e,t,n){var r=t-e.length;return r<=0?e:C(n,r)+e}function R(e,t,n,r){return{from:e-t>0?e-t:0,to:e+n>r?r:e+n}}function U(e,t){var n,r,a,s,u,c=t.index,l=c.offset,f=1;if(l===e.length)return"Got the end of the input";if(b(e)){var d=l-l%8,p=l-d,h=R(d,40,40,e.length),g=function(e,t){var n=e.length,r=[],i=0;if(n<=8)return[e.slice()];for(var o=0;o<n;o++)r[i]||r.push([]),r[i].push(e[o]),(o+1)%8==0&&i++;return r}(e.slice(h.from,h.to).toJSON().data),v=o((function(e){return o((function(e){return M(e.toString(16),2,"0")}),e)}),g);s=function(e){return 0===e.from&&1===e.to?{from:e.from,to:e.to}:{from:e.from/8,to:Math.floor(e.to/8)}}(h),r=d/8,n=3*p,p>=4&&(n+=1),f=2,a=o((function(e){return e.length<=4?e.join(" "):e.slice(0,4).join(" ")+"  "+e.slice(4).join(" ")}),v),(u=(8*(s.to>0?s.to-1:s.to)).toString(16).length)<2&&(u=2)}else{var y=e.split(/\r\n|[\n\r\u2028\u2029]/);n=c.column-1,r=c.line-1,s=R(r,2,3,y.length),a=y.slice(s.from,s.to),u=s.to.toString().length}var m=r-s.from;b(e)&&(u=(8*(s.to>0?s.to-1:s.to)).toString(16).length)<2&&(u=2);var _=i((function(t,r,i){var o,a=i===m,c=a?"> ":"  ";return o=b(e)?M((8*(s.from+i)).toString(16),u,"0"):M((s.from+i+1).toString(),u," "),[].concat(t,[c+o+" | "+r],a?["  "+C(" ",u)+" | "+M("",n," ")+C("^",f)]:[])}),[],a);return _.join("\n")}function N(e,t){return["\n","-- PARSING FAILED "+C("-",50),"\n\n",U(e,t),"\n\n",(n=t.expected,1===n.length?"Expected:\n\n"+n[0]:"Expected one of the following: \n\n"+n.join(", ")),"\n"].join("");var n}function A(e){return void 0!==e.flags?e.flags:[e.global?"g":"",e.ignoreCase?"i":"",e.multiline?"m":"",e.unicode?"u":"",e.sticky?"y":""].join("")}function B(e){return RegExp("^(?:"+e.source+")",A(e))}function $(){for(var e=[].slice.call(arguments),n=e.length,r=0;r<n;r+=1)E(e[r]);return t((function(t,r){for(var i,o=new Array(n),a=0;a<n;a+=1){if(!(i=x(e[a]._(t,r),i)).status)return i;o[a]=i.value,r=i.index}return x(w(r,o),i)}))}function V(){var e=[].slice.call(arguments);if(0===e.length)throw new Error("seqMap needs at least one argument");var t=e.pop();return S(t),$.apply(null,e).map((function(e){return t.apply(null,e)}))}function W(){var e=[].slice.call(arguments),n=e.length;if(0===n)return Y("zero alternates");for(var r=0;r<n;r+=1)E(e[r]);return t((function(t,n){for(var r,i=0;i<e.length;i+=1)if((r=x(e[i]._(t,n),r)).status)return r;return r}))}function L(e,t){return q(e,t).or(z([]))}function q(e,t){return E(e),E(t),V(e,t.then(e).many(),(function(e,t){return[e].concat(t)}))}function F(e){D(e);var n="'"+e+"'";return t((function(t,r){var i=r+e.length,o=t.slice(r,i);return o===e?w(i,o):O(r,n)}))}function H(e,n){T(e),arguments.length>=2?k(n):n=0;var r=B(e),i=""+e;return t((function(e,t){var o=r.exec(e.slice(t));if(o){if(0<=n&&n<=o.length){var a=o[0],s=o[n];return w(t+a.length,s)}return O(t,"valid match group (0 to "+o.length+") in "+i)}return O(t,i)}))}function z(e){return t((function(t,n){return w(n,e)}))}function Y(e){return t((function(t,n){return O(n,e)}))}function G(e){if(m(e))return t((function(t,n){var r=e._(t,n);return r.index=n,r.value="",r}));if("string"==typeof e)return G(F(e));if(e instanceof RegExp)return G(H(e));throw new Error("not a string, regexp, or parser: "+e)}function K(e){return E(e),t((function(t,n){var r=e._(t,n),i=t.slice(n,r.index);return r.status?O(n,'not "'+i+'"'):w(n,null)}))}function X(e){return S(e),t((function(t,n){var r=I(t,n);return n<t.length&&e(r)?w(n+1,r):O(n,"a character/byte matching "+e)}))}function J(e,n){arguments.length<2&&(n=e,e=void 0);var r=t((function(e,t){return r._=n()._,r._(e,t)}));return e?r.desc(e):r}function Z(){return Y("fantasy-land/empty")}n.parse=function(e){if("string"!=typeof e&&!b(e))throw new Error(".parse must be called with a string or Buffer as its argument");var t,n=this.skip(ne)._(e,0);return t=n.status?{status:!0,value:n.value}:{status:!1,index:P(e,n.furthest),expected:n.expected},delete j[e],t},n.tryParse=function(e){var t=this.parse(e);if(t.status)return t.value;var n=N(e,t),r=new Error(n);throw r.type="ParsimmonError",r.result=t,r},n.assert=function(e,t){return this.chain((function(n){return e(n)?z(n):Y(t)}))},n.or=function(e){return W(this,e)},n.trim=function(e){return this.wrap(e,e)},n.wrap=function(e,t){return V(e,this,t,(function(e,t){return t}))},n.thru=function(e){return e(this)},n.then=function(e){return E(e),$(this,e).map((function(e){return e[1]}))},n.many=function(){var e=this;return t((function(t,n){for(var r=[],i=void 0;;){if(!(i=x(e._(t,n),i)).status)return x(w(n,r),i);if(n===i.index)throw new Error("infinite loop detected in .many() parser --- calling .many() on a parser which can accept zero characters is usually the cause");n=i.index,r.push(i.value)}}))},n.tieWith=function(e){return D(e),this.map((function(t){if(function(e){if(!_(e))throw new Error("not an array: "+e)}(t),t.length){D(t[0]);for(var n=t[0],r=1;r<t.length;r++)D(t[r]),n+=e+t[r];return n}return""}))},n.tie=function(){return this.tieWith("")},n.times=function(e,n){var r=this;return arguments.length<2&&(n=e),k(e),k(n),t((function(t,i){for(var o=[],a=void 0,s=void 0,u=0;u<e;u+=1){if(s=x(a=r._(t,i),s),!a.status)return s;i=a.index,o.push(a.value)}for(;u<n&&(s=x(a=r._(t,i),s),a.status);u+=1)i=a.index,o.push(a.value);return x(w(i,o),s)}))},n.result=function(e){return this.map((function(){return e}))},n.atMost=function(e){return this.times(0,e)},n.atLeast=function(e){return V(this.times(e),this.many(),(function(e,t){return e.concat(t)}))},n.map=function(e){S(e);var n=this;return t((function(t,r){var i=n._(t,r);return i.status?x(w(i.index,e(i.value)),i):i}))},n.contramap=function(e){S(e);var n=this;return t((function(t,r){var i=n.parse(e(t.slice(r)));return i.status?w(r+t.length,i.value):i}))},n.promap=function(e,t){return S(e),S(t),this.contramap(e).map(t)},n.skip=function(e){return $(this,e).map((function(e){return e[0]}))},n.mark=function(){return V(Q,this,Q,(function(e,t,n){return{start:e,value:t,end:n}}))},n.node=function(e){return V(Q,this,Q,(function(t,n,r){return{name:e,value:n,start:t,end:r}}))},n.sepBy=function(e){return L(this,e)},n.sepBy1=function(e){return q(this,e)},n.lookahead=function(e){return this.skip(G(e))},n.notFollowedBy=function(e){return this.skip(K(e))},n.desc=function(e){_(e)||(e=[e]);var n=this;return t((function(t,r){var i=n._(t,r);return i.status||(i.expected=e),i}))},n.fallback=function(e){return this.or(z(e))},n.ap=function(e){return V(e,this,(function(e,t){return e(t)}))},n.chain=function(e){var n=this;return t((function(t,r){var i=n._(t,r);return i.status?x(e(i.value)._(t,i.index),i):i}))},n.concat=n.or,n.empty=Z,n.of=z,n["fantasy-land/ap"]=n.ap,n["fantasy-land/chain"]=n.chain,n["fantasy-land/concat"]=n.concat,n["fantasy-land/empty"]=n.empty,n["fantasy-land/of"]=n.of,n["fantasy-land/map"]=n.map;var Q=t((function(e,t){return w(t,P(e,t))})),ee=t((function(e,t){return t>=e.length?O(t,"any character/byte"):w(t+1,I(e,t))})),te=t((function(e,t){return w(e.length,e.slice(t))})),ne=t((function(e,t){return t<e.length?O(t,"EOF"):w(t,null)})),re=H(/[0-9]/).desc("a digit"),ie=H(/[0-9]*/).desc("optional digits"),oe=H(/[a-z]/i).desc("a letter"),ae=H(/[a-z]*/i).desc("optional letters"),se=H(/\s*/).desc("optional whitespace"),ue=H(/\s+/).desc("whitespace"),ce=F("\r"),le=F("\n"),fe=F("\r\n"),de=W(fe,le,ce).desc("newline"),pe=W(de,ne);t.all=te,t.alt=W,t.any=ee,t.cr=ce,t.createLanguage=function(e){var t={};for(var n in e)({}).hasOwnProperty.call(e,n)&&function(n){t[n]=J((function(){return e[n](t)}))}(n);return t},t.crlf=fe,t.custom=function(e){return t(e(w,O))},t.digit=re,t.digits=ie,t.empty=Z,t.end=pe,t.eof=ne,t.fail=Y,t.formatError=N,t.index=Q,t.isParser=m,t.lazy=J,t.letter=oe,t.letters=ae,t.lf=le,t.lookahead=G,t.makeFailure=O,t.makeSuccess=w,t.newline=de,t.noneOf=function(e){return X((function(t){return e.indexOf(t)<0})).desc("none of '"+e+"'")},t.notFollowedBy=K,t.of=z,t.oneOf=function(e){for(var t=e.split(""),n=0;n<t.length;n++)t[n]="'"+t[n]+"'";return X((function(t){return e.indexOf(t)>=0})).desc(t)},t.optWhitespace=se,t.Parser=t,t.range=function(e,t){return X((function(n){return e<=n&&n<=t})).desc(e+"-"+t)},t.regex=H,t.regexp=H,t.sepBy=L,t.sepBy1=q,t.seq=$,t.seqMap=V,t.seqObj=function(){for(var e={},n=0,r=y(arguments),i=r.length,o=0;o<i;o+=1){var a=r[o];if(!m(a)){if(_(a)){var s=2===a.length&&"string"==typeof a[0]&&m(a[1]);if(s){var u=a[0];if(Object.prototype.hasOwnProperty.call(e,u))throw new Error("seqObj: duplicate key "+u);e[u]=!0,n++;continue}}throw new Error("seqObj arguments must be parsers or [string, parser] array pairs.")}}if(0===n)throw new Error("seqObj expects at least one named parser, found zero");return t((function(e,t){for(var n,o={},a=0;a<i;a+=1){var s,u;if(_(r[a])?(s=r[a][0],u=r[a][1]):(s=null,u=r[a]),!(n=x(u._(e,t),n)).status)return n;s&&(o[s]=n.value),t=n.index}return x(w(t,o),n)}))},t.string=F,t.succeed=z,t.takeWhile=function(e){return S(e),t((function(t,n){for(var r=n;r<t.length&&e(I(t,r));)r++;return w(r,t.slice(n,r))}))},t.test=X,t.whitespace=ue,t["fantasy-land/empty"]=Z,t["fantasy-land/of"]=z,t.Binary={bitSeq:l,bitSeqObj:function(e){c();var t={},n=0,r=o((function(e){if(_(e)){var r=e;if(2!==r.length)throw new Error("["+r.join(", ")+"] should be length 2, got length "+r.length);if(D(r[0]),k(r[1]),Object.prototype.hasOwnProperty.call(t,r[0]))throw new Error("duplicate key in bitSeqObj: "+r[0]);return t[r[0]]=!0,n++,r}return k(e),[null,e]}),e);if(n<1)throw new Error("bitSeqObj expects at least one named pair, got ["+e.join(", ")+"]");var a=o((function(e){return e[0]}),r);return l(o((function(e){return e[1]}),r)).map((function(e){return i((function(e,t){return null!==t[0]&&(e[t[0]]=t[1]),e}),{},o((function(t,n){return[t,e[n]]}),a))}))},byte:function(e){if(c(),k(e),e>255)throw new Error("Value specified to byte constructor ("+e+"=0x"+e.toString(16)+") is larger in value than a single byte.");var n=(e>15?"0x":"0x0")+e.toString(16);return t((function(t,r){var i=I(t,r);return i===e?w(r+1,i):O(r,n)}))},buffer:function(e){return f("buffer",e).map((function(e){return Buffer.from(e)}))},encodedString:function(e,t){return f("string",t).map((function(t){return t.toString(e)}))},uintBE:p,uint8BE:p(1),uint16BE:p(2),uint32BE:p(4),uintLE:h,uint8LE:h(1),uint16LE:h(2),uint32LE:h(4),intBE:g,int8BE:g(1),int16BE:g(2),int32BE:g(4),intLE:v,int8LE:v(1),int16LE:v(2),int32LE:v(4),floatBE:f("floatBE",4).map((function(e){return e.readFloatBE(0)})),floatLE:f("floatLE",4).map((function(e){return e.readFloatLE(0)})),doubleBE:f("doubleBE",8).map((function(e){return e.readDoubleBE(0)})),doubleLE:f("doubleLE",8).map((function(e){return e.readDoubleLE(0)}))},e.exports=t},8660:()=>{var e;!function(e){!function(t){var n="object"==typeof global?global:"object"==typeof self?self:"object"==typeof this?this:Function("return this;")(),r=i(e);function i(e,t){return function(n,r){"function"!=typeof e[n]&&Object.defineProperty(e,n,{configurable:!0,writable:!0,value:r}),t&&t(n,r)}}void 0===n.Reflect?n.Reflect=e:r=i(n.Reflect,r),function(e){var t=Object.prototype.hasOwnProperty,n="function"==typeof Symbol,r=n&&void 0!==Symbol.toPrimitive?Symbol.toPrimitive:"@@toPrimitive",i=n&&void 0!==Symbol.iterator?Symbol.iterator:"@@iterator",o="function"==typeof Object.create,a={__proto__:[]}instanceof Array,s=!o&&!a,u={create:o?function(){return U(Object.create(null))}:a?function(){return U({__proto__:null})}:function(){return U({})},has:s?function(e,n){return t.call(e,n)}:function(e,t){return t in e},get:s?function(e,n){return t.call(e,n)?e[n]:void 0}:function(e,t){return e[t]}},c=Object.getPrototypeOf(Function),l="object"==typeof process&&process.env&&"true"===process.env.REFLECT_METADATA_USE_MAP_POLYFILL,f=l||"function"!=typeof Map||"function"!=typeof Map.prototype.entries?function(){var e={},t=[],n=function(){function e(e,t,n){this._index=0,this._keys=e,this._values=t,this._selector=n}return e.prototype["@@iterator"]=function(){return this},e.prototype[i]=function(){return this},e.prototype.next=function(){var e=this._index;if(e>=0&&e<this._keys.length){var n=this._selector(this._keys[e],this._values[e]);return e+1>=this._keys.length?(this._index=-1,this._keys=t,this._values=t):this._index++,{value:n,done:!1}}return{value:void 0,done:!0}},e.prototype.throw=function(e){throw this._index>=0&&(this._index=-1,this._keys=t,this._values=t),e},e.prototype.return=function(e){return this._index>=0&&(this._index=-1,this._keys=t,this._values=t),{value:e,done:!0}},e}();return function(){function t(){this._keys=[],this._values=[],this._cacheKey=e,this._cacheIndex=-2}return Object.defineProperty(t.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),t.prototype.has=function(e){return this._find(e,!1)>=0},t.prototype.get=function(e){var t=this._find(e,!1);return t>=0?this._values[t]:void 0},t.prototype.set=function(e,t){var n=this._find(e,!0);return this._values[n]=t,this},t.prototype.delete=function(t){var n=this._find(t,!1);if(n>=0){for(var r=this._keys.length,i=n+1;i<r;i++)this._keys[i-1]=this._keys[i],this._values[i-1]=this._values[i];return this._keys.length--,this._values.length--,t===this._cacheKey&&(this._cacheKey=e,this._cacheIndex=-2),!0}return!1},t.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=e,this._cacheIndex=-2},t.prototype.keys=function(){return new n(this._keys,this._values,r)},t.prototype.values=function(){return new n(this._keys,this._values,o)},t.prototype.entries=function(){return new n(this._keys,this._values,a)},t.prototype["@@iterator"]=function(){return this.entries()},t.prototype[i]=function(){return this.entries()},t.prototype._find=function(e,t){return this._cacheKey!==e&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=e)),this._cacheIndex<0&&t&&(this._cacheIndex=this._keys.length,this._keys.push(e),this._values.push(void 0)),this._cacheIndex},t}();function r(e,t){return e}function o(e,t){return t}function a(e,t){return[e,t]}}():Map,d=l||"function"!=typeof Set||"function"!=typeof Set.prototype.entries?function(){function e(){this._map=new f}return Object.defineProperty(e.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),e.prototype.has=function(e){return this._map.has(e)},e.prototype.add=function(e){return this._map.set(e,e),this},e.prototype.delete=function(e){return this._map.delete(e)},e.prototype.clear=function(){this._map.clear()},e.prototype.keys=function(){return this._map.keys()},e.prototype.values=function(){return this._map.values()},e.prototype.entries=function(){return this._map.entries()},e.prototype["@@iterator"]=function(){return this.keys()},e.prototype[i]=function(){return this.keys()},e}():Set,p=new(l||"function"!=typeof WeakMap?function(){var e=u.create(),n=r();return function(){function e(){this._key=r()}return e.prototype.has=function(e){var t=i(e,!1);return void 0!==t&&u.has(t,this._key)},e.prototype.get=function(e){var t=i(e,!1);return void 0!==t?u.get(t,this._key):void 0},e.prototype.set=function(e,t){return i(e,!0)[this._key]=t,this},e.prototype.delete=function(e){var t=i(e,!1);return void 0!==t&&delete t[this._key]},e.prototype.clear=function(){this._key=r()},e}();function r(){var t;do{t="@@WeakMap@@"+a()}while(u.has(e,t));return e[t]=!0,t}function i(e,r){if(!t.call(e,n)){if(!r)return;Object.defineProperty(e,n,{value:u.create()})}return e[n]}function o(e,t){for(var n=0;n<t;++n)e[n]=255*Math.random()|0;return e}function a(){var e,t=(e=16,"function"==typeof Uint8Array?"undefined"!=typeof crypto?crypto.getRandomValues(new Uint8Array(e)):"undefined"!=typeof msCrypto?msCrypto.getRandomValues(new Uint8Array(e)):o(new Uint8Array(e),e):o(new Array(e),e));t[6]=79&t[6]|64,t[8]=191&t[8]|128;for(var n="",r=0;r<16;++r){var i=t[r];4!==r&&6!==r&&8!==r||(n+="-"),i<16&&(n+="0"),n+=i.toString(16).toLowerCase()}return n}}():WeakMap);function h(e,t,n){var r=p.get(e);if(x(r)){if(!n)return;r=new f,p.set(e,r)}var i=r.get(t);if(x(i)){if(!n)return;i=new f,r.set(t,i)}return i}function g(e,t,n){if(v(e,t,n))return!0;var r=R(t);return!j(r)&&g(e,r,n)}function v(e,t,n){var r=h(t,n,!1);return!x(r)&&!!r.has(e)}function y(e,t,n){if(v(e,t,n))return m(e,t,n);var r=R(t);return j(r)?void 0:y(e,r,n)}function m(e,t,n){var r=h(t,n,!1);if(!x(r))return r.get(e)}function _(e,t,n,r){h(n,r,!0).set(e,t)}function b(e,t){var n=w(e,t),r=R(e);if(null===r)return n;var i=b(r,t);if(i.length<=0)return n;if(n.length<=0)return i;for(var o=new d,a=[],s=0,u=n;s<u.length;s++){var c=u[s];o.has(c)||(o.add(c),a.push(c))}for(var l=0,f=i;l<f.length;l++)c=f[l],o.has(c)||(o.add(c),a.push(c));return a}function w(e,t){var n=[],r=h(e,t,!1);if(x(r))return n;for(var o=function(e){var t=D(e,i);if(!T(t))throw new TypeError;var n=t.call(e);if(!P(n))throw new TypeError;return n}(r.keys()),a=0;;){var s=C(o);if(!s)return n.length=a,n;var u=s.value;try{n[a]=u}catch(e){try{M(o)}finally{throw e}}a++}}function O(e){if(null===e)return 1;switch(typeof e){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return null===e?1:6;default:return 6}}function x(e){return void 0===e}function j(e){return null===e}function P(e){return"object"==typeof e?null!==e:"function"==typeof e}function E(e,t){switch(O(e)){case 0:case 1:case 2:case 3:case 4:case 5:return e}var n=3===t?"string":5===t?"number":"default",i=D(e,r);if(void 0!==i){var o=i.call(e,n);if(P(o))throw new TypeError;return o}return function(e,t){if("string"===t){var n=e.toString;if(T(n)&&!P(i=n.call(e)))return i;if(T(r=e.valueOf)&&!P(i=r.call(e)))return i}else{var r;if(T(r=e.valueOf)&&!P(i=r.call(e)))return i;var i,o=e.toString;if(T(o)&&!P(i=o.call(e)))return i}throw new TypeError}(e,"default"===n?"number":n)}function I(e){var t=E(e,3);return"symbol"==typeof t?t:function(e){return""+e}(t)}function k(e){return Array.isArray?Array.isArray(e):e instanceof Object?e instanceof Array:"[object Array]"===Object.prototype.toString.call(e)}function T(e){return"function"==typeof e}function S(e){return"function"==typeof e}function D(e,t){var n=e[t];if(null!=n){if(!T(n))throw new TypeError;return n}}function C(e){var t=e.next();return!t.done&&t}function M(e){var t=e.return;t&&t.call(e)}function R(e){var t=Object.getPrototypeOf(e);if("function"!=typeof e||e===c)return t;if(t!==c)return t;var n=e.prototype,r=n&&Object.getPrototypeOf(n);if(null==r||r===Object.prototype)return t;var i=r.constructor;return"function"!=typeof i||i===e?t:i}function U(e){return e.__=void 0,delete e.__,e}e("decorate",(function(e,t,n,r){if(x(n)){if(!k(e))throw new TypeError;if(!S(t))throw new TypeError;return function(e,t){for(var n=e.length-1;n>=0;--n){var r=(0,e[n])(t);if(!x(r)&&!j(r)){if(!S(r))throw new TypeError;t=r}}return t}(e,t)}if(!k(e))throw new TypeError;if(!P(t))throw new TypeError;if(!P(r)&&!x(r)&&!j(r))throw new TypeError;return j(r)&&(r=void 0),function(e,t,n,r){for(var i=e.length-1;i>=0;--i){var o=(0,e[i])(t,n,r);if(!x(o)&&!j(o)){if(!P(o))throw new TypeError;r=o}}return r}(e,t,n=I(n),r)})),e("metadata",(function(e,t){return function(n,r){if(!P(n))throw new TypeError;if(!x(r)&&!function(e){switch(O(e)){case 3:case 4:return!0;default:return!1}}(r))throw new TypeError;_(e,t,n,r)}})),e("defineMetadata",(function(e,t,n,r){if(!P(n))throw new TypeError;return x(r)||(r=I(r)),_(e,t,n,r)})),e("hasMetadata",(function(e,t,n){if(!P(t))throw new TypeError;return x(n)||(n=I(n)),g(e,t,n)})),e("hasOwnMetadata",(function(e,t,n){if(!P(t))throw new TypeError;return x(n)||(n=I(n)),v(e,t,n)})),e("getMetadata",(function(e,t,n){if(!P(t))throw new TypeError;return x(n)||(n=I(n)),y(e,t,n)})),e("getOwnMetadata",(function(e,t,n){if(!P(t))throw new TypeError;return x(n)||(n=I(n)),m(e,t,n)})),e("getMetadataKeys",(function(e,t){if(!P(e))throw new TypeError;return x(t)||(t=I(t)),b(e,t)})),e("getOwnMetadataKeys",(function(e,t){if(!P(e))throw new TypeError;return x(t)||(t=I(t)),w(e,t)})),e("deleteMetadata",(function(e,t,n){if(!P(t))throw new TypeError;x(n)||(n=I(n));var r=h(t,n,!1);if(x(r))return!1;if(!r.delete(e))return!1;if(r.size>0)return!0;var i=p.get(t);return i.delete(n),i.size>0||p.delete(t),!0}))}(r)}()}(e||(e={}))},5099:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.AllViewables=void 0;const s=a(n(9496)),u=n(2663),c=n(994),l=n(4869);let f=class{constructor(){this._groups=new Set,this._allViewables=[]}get allViewables(){return this._allViewables}addViewable(e){if(this.allViewables.includes(e))return void(0,l.logWarn)("Viewable already added",e.type);this._allViewables.push(e);const t=this._allViewables,n=e.group,r=this._groups,i=[];if(!r.has(n)){r.add(n);const e=`svifpd.watch-view-${n}`;i.push(s.commands.registerCommand(e,(0,c.makeViewWatchTreeItemCommand)(n)))}return{dispose:()=>{const o=t.indexOf(e);o>-1&&t.splice(o,1),t.some((e=>e.group===n))||(r.delete(n),i.forEach((e=>e.dispose())))}}}};f=o([(0,u.Service)()],f),t.AllViewables=f},3498:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return i(t,e),t},a=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.CodeActionProvider=void 0;const s=o(n(9496)),u=n(20),c=n(1091),l=n(1700),f=n(7052);t.CodeActionProvider=class{constructor(){this._lastCall=0}provideCodeActions(e,t){return a(this,void 0,void 0,(function*(){const n=s.debug.activeDebugSession;if(void 0===n)return;const r=(0,u.activeDebugSessionData)(n);if(!1===r.isStopped||!1===r.setupOkay)return;const i=(0,f.currentUserSelection)(e,t);if(void 0===i)return;if(Date.now()-this._lastCall<1e3)return;setTimeout((()=>{this._lastCall=Date.now()}));const o=yield(0,c.findExpressionViewables)((0,f.selectionString)(i),n);return o.err?void 0:(0,l.arrayUniqueByKey)(o.safeUnwrap(),(e=>e.title)).map((e=>({title:`View ${e.title}`,command:"svifpd._internal_view-object",arguments:[i,e,n]})))}))}}},853:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return i(t,e),t},a=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.HoverProvider=void 0;const s=o(n(9496)),u=n(20),c=n(2432),l=n(3934),f=n(2127);t.HoverProvider=class{provideHover(e,t){return a(this,void 0,void 0,(function*(){const n=s.debug.activeDebugSession;if(void 0===n||!1===(0,u.activeDebugSessionData)(n).isStopped)return;const r=e.getWordRangeAtPosition(t),i=e.getText(r);if(""===i)return;const o=(0,c.constructObjectShapeCode)(i),a=(0,f.joinResult)(yield(0,l.evaluateInPython)(o,n));if(a.err)return;const d=function(e){return Array.isArray(e)?`shape: (${e.join(", ")})`:"("+Object.entries(e).map((([e,t])=>`${e}=${t}`)).join(", ")+")"}(a.safeUnwrap());return new s.Hover(new s.MarkdownString(d),r)}))}}},4869:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.logError=t.logWarn=t.logInfo=t.logDebug=t.logTrace=t.initLog=void 0;const a=o(n(9496)),s=n(8913);function u(e,t){if(t instanceof Error){const e={};return Object.getOwnPropertyNames(t).forEach((function(n){e[n]=t[n]})),e}return t}var c;!function(e){e[e.None=0]="None",e[e.Trace=1]="Trace",e[e.Debug=2]="Debug",e[e.Info=3]="Info",e[e.Warn=4]="Warn",e[e.Error=5]="Error"}(c||(c={}));let l,f=c.Trace;t.initLog=function(){const e=(0,s.getConfiguration)("debug");switch("none"!==e&&void 0===l?l=a.window.createOutputChannel("View Image for Python"):"none"===e&&void 0!==l&&(l.dispose(),l=void 0),e){case"verbose":f=c.Trace;break;case"debug":f=c.Debug;break;default:f=c.None}};const d={[c.None]:"None",[c.Trace]:"Trace",[c.Debug]:"Debug",[c.Info]:"Info",[c.Warn]:"Warn",[c.Error]:"Error"};function p(e,...t){if(void 0===l)return;const n=(t=[`[${d[e]}]`,...t]).map((e=>JSON.stringify(e,u,2))).join(" ");l.appendLine(n)}t.logTrace=function(...e){f<=c.Trace&&p(c.Trace,...e)},t.logDebug=function(...e){f<=c.Debug&&p(c.Debug,...e)},t.logInfo=function(...e){f<=c.Info&&p(c.Info,...e)},t.logWarn=function(...e){f<=c.Warn&&p(c.Warn,...e)},t.logError=function(...e){f<=c.Error&&p(c.Error,...e)}},1091:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.findExpressionsViewables=t.findExpressionViewables=void 0;const o=i(n(2663)),a=n(5099),s=n(4869),u=n(2432),c=n(3934),l=n(2127);function f(e,t){return t.map(((e,t)=>({isOfType:e,i:t}))).filter((({isOfType:e})=>!e.err&&e.safeUnwrap())).map((({i:t})=>e[t]))}t.findExpressionViewables=function(e,t){return r(this,void 0,void 0,(function*(){const n=o.default.get(a.AllViewables).allViewables,r=(0,u.constructRunSameExpressionWithMultipleEvaluatorsCode)(e,n.map((e=>e.testTypePythonCode))),i=yield(0,c.evaluateInPython)(r,t);if(i.err)return(0,s.logError)(`Error finding viewables for expression \`${e}\`. Error: ${(0,l.errorMessage)(i)}`),(0,l.Err)((0,l.errorMessage)(i));{const e=f(n,i.safeUnwrap());return(0,l.Ok)(e)}}))},t.findExpressionsViewables=function(e,t){return r(this,void 0,void 0,(function*(){const n=o.default.get(a.AllViewables).allViewables,r=e.map((e=>(0,u.constructRunSameExpressionWithMultipleEvaluatorsCode)(e,n.map((e=>e.testTypePythonCode))))),i=(0,u.combineMultiEvalCodePython)(r),d=yield(0,c.evaluateInPython)(i,t);if(d.err){const t=`Error finding viewables for expressions \`${e.join(", ")}\`. Error: ${(0,l.errorMessage)(d)}`;return(0,s.logError)(t),(0,l.Err)((0,l.errorMessage)(d))}{const e=d.safeUnwrap().map((e=>f(n,e)));return(0,l.Ok)(e)}}))}},1115:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return i(t,e),t},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.SavePathHelper=t.setSaveLocation=void 0;const s=o(n(3292)),u=a(n(2663)),c=o(n(1017)),l=n(2037),f=n(5888),d=n(8913),p=n(7147),h=n(4869),g=n(2127);function v(){var e;return null!==(e=u.default.get("saveDir"))&&void 0!==e?e:c.join((0,l.tmpdir)(),f.EXTENSION_NAME,"images")}t.setSaveLocation=function(e){var t,n;const r=null!==(t=(0,d.getConfiguration)("saveLocation"))&&void 0!==t?t:"tmp";let i;"custom"===r?((0,h.logDebug)("Using custom save location for saving files"),i=null!==(n=(0,d.getConfiguration)("customSavePath"))&&void 0!==n?n:v()):"extensionStorage"===r?((0,h.logDebug)("Using extension storage for saving files"),i=c.join(e.globalStorageUri.fsPath,f.EXTENSION_NAME,"images")):((0,h.logDebug)("Using tmp folder for saving files"),i=c.join((0,l.tmpdir)(),f.EXTENSION_NAME,"images")),(0,h.logDebug)("saveDir: "+i),(0,p.existsSync)(i)||((0,h.logDebug)("create save directory"),(0,p.mkdirSync)(i,{recursive:!0}),"tmp"!==r&&void 0!==r||(0,p.chmodSync)(i,511)),u.default.set("saveDir",i)};class y{constructor(e){this.saveDir=c.join(v(),e),this.mkdir()}mkdir(){try{return(0,p.mkdirSync)(this.saveDir,{recursive:!0}),(0,g.Ok)(void 0)}catch(e){return e instanceof Error?(0,g.Err)(e):(0,g.Err)(JSON.stringify(e))}}deleteSaveDir(){return s.rm(this.saveDir,{recursive:!0,force:!0})}static normalizePath(e){return e.replace(/\\/g,"/")}savePathFor(e){return"expression"in e?y.normalizePath(c.join(this.saveDir,Math.random().toString(36).substring(2,8))):y.normalizePath(c.join(this.saveDir,`${e.variable}`))}}t.SavePathHelper=y},5928:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return i(t,e),t},a=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.trackObjectUnderCursor=t.viewObjectUnderCursor=t.viewObject=void 0;const u=o(n(9496)),c=n(20),l=n(7052),f=n(1091),d=s(n(2663)),p=n(2720),h=n(1525),g=n(8913),v=n(2211),y=n(4030),m=n(8085),_=n(4869);function b(e,t,n,r,i,o){return a(this,void 0,void 0,(function*(){if(null!=o&&o||!0!==t.supportsImageViewer||!0!==(0,g.getConfiguration)("useExperimentalViewer",void 0,!1)){const o=yield(0,h.serializePythonObjectToDisk)(e,t,n,r);void 0!==o&&(void 0!==t.onShow?yield t.onShow(o):yield(0,l.openImageToTheSide)(o,null==i||i))}else{const o=yield(0,v.serializeImageUsingSocketServer)(e,t,n);if(o.err)return(0,_.logWarn)(o.val),b(e,t,n,r,i,!0);{const e=d.default.get(y.WebviewClient);yield e.reveal(),e.sendRequest(m.WebviewResponses.showImage(o.safeUnwrap()))}}}))}t.viewObject=b,t.viewObjectUnderCursor=function(){var e,t;return a(this,void 0,void 0,(function*(){const n=u.debug.activeDebugSession,r=null===(e=u.window.activeTextEditor)||void 0===e?void 0:e.document,i=null===(t=u.window.activeTextEditor)||void 0===t?void 0:t.selection;if(void 0===n||void 0===r||void 0===i)return;const o=(0,l.currentUserSelection)(r,i);if(void 0===o)return;const a=yield(0,f.findExpressionViewables)((0,l.selectionString)(o),n);return a.err||0===a.safeUnwrap().length?void 0:b(o,a.safeUnwrap()[0],n)}))},t.trackObjectUnderCursor=function(){var e,t;return a(this,void 0,void 0,(function*(){const n=u.debug.activeDebugSession,r=null===(e=u.window.activeTextEditor)||void 0===e?void 0:e.document,i=null===(t=u.window.activeTextEditor)||void 0===t?void 0:t.selection;if(void 0===n||void 0===r||void 0===i)return;const o=(0,l.currentUserSelection)(r,i);if(void 0===o)return;const a=(0,l.selectionString)(o),s=(0,c.activeDebugSessionData)(n),h=s.currentPythonObjectsList.find(a),g=yield(0,f.findExpressionViewables)(a,n);let v;if(void 0===h&&(yield s.currentPythonObjectsList.addExpression(a)),g.ok&&g.safeUnwrap().length>0){const e=s.trackedPythonObjects,t=e.trackingIdIfTracked({expression:a}),n=t?e.savePath(t):void 0;v=null!=n?n:s.savePathHelper.savePathFor(o),e.track({expression:a},g.safeUnwrap()[0],v,t)}return d.default.get(p.WatchTreeProvider).refresh(),g.err||0===g.safeUnwrap().length?void 0:b(o,g.safeUnwrap()[0],n,v,!1)}))}},5049:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return i(t,e),t},a=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.registerExtensionCommands=t.executeCommand=void 0;const u=o(n(9496)),c=n(6822),l=n(3111),f=n(994),d=n(6381),p=n(5928),h=s(n(2663)),g=n(4030),v=n(3741),y={"svifpd.run-setup":function(){return a(this,void 0,void 0,(function*(){const e=u.debug.activeDebugSession;e&&(yield(0,v.runSetup)(e,!0))}))},"svifpd.open-settings":function(){return a(this,void 0,void 0,(function*(){yield u.commands.executeCommand("workbench.action.openSettings",{query:"svifpd"})}))},"svifpd.open-image-webview":function(){return a(this,void 0,void 0,(function*(){h.default.get(g.WebviewClient).reveal()}))},"svifpd.watch-refresh":f.refreshWatchTree,"svifpd._internal_view-object":p.viewObject,"svifpd.add-expression":l.addExpressionTreeItem,"svifpd.edit-expression":l.editExpressionTreeItem,"svifpd.remove-expression":l.removeExpressionTreeItem,"svifpd.remove-all-expressions":l.removeAllExpressionsTree,"svifpd.watch-track-enable":f.trackPythonObjectTreeItem,"svifpd.watch-track-disable":f.untrackPythonObjectTreeItem,"svifpd.update-frame-id":c.updateDebugFrameId,"svifpd.view-image":p.viewObjectUnderCursor,"svifpd.view-image-track":p.trackObjectUnderCursor,"svifpd.view-debug-variable":c.viewVariableFromVSCodeDebugViewAsImage,"svifpd.disable-plugin":d.disablePluginCommand};function m(e){return function(e,t){return u.commands.registerCommand(e,t)}(e,y[e])}t.executeCommand=function(e,...t){return u.commands.executeCommand(e,...t)},t.registerExtensionCommands=function(e){return[m("svifpd.run-setup"),m("svifpd.view-image"),m("svifpd.view-image-track"),m("svifpd._internal_view-object"),m("svifpd.add-expression"),m("svifpd.edit-expression"),m("svifpd.remove-expression"),m("svifpd.remove-all-expressions"),m("svifpd.watch-track-enable"),m("svifpd.watch-track-disable"),m("svifpd.watch-refresh"),m("svifpd.open-settings"),m("svifpd.open-image-webview"),m("svifpd.update-frame-id"),m("svifpd.view-debug-variable"),m("svifpd.disable-plugin")]}},9180:(e,t)=>{"use strict";var n,r;Object.defineProperty(t,"__esModule",{value:!0}),t.DimensionOrder=t.ArrayDataType=void 0,(r=t.ArrayDataType||(t.ArrayDataType={})).Float32="float32",r.Float64="float64",r.Int8="int8",r.Int16="int16",r.Int32="int32",r.Int64="int64",r.UInt8="uint8",r.UInt16="uint16",r.UInt32="uint32",r.UInt64="uint64",r.Bool="bool",(n=t.DimensionOrder||(t.DimensionOrder={})).HWC="hwc",n.CHW="chw"},8913:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getConfiguration=t.EXTENSION_CONFIG_SECTION=t.NormalizationMethods=t.Backends=void 0;const r=n(899);var i,o;(o=t.Backends||(t.Backends={})).opencv="opencv",o.imageio="imageio",o.Pillow="Pillow",o.Standalone="Standalone",(i=t.NormalizationMethods||(t.NormalizationMethods={})).normalize="normalize",i.skimage_img_as_ubyte="skimage.img_as_ubyte",i.None="None",t.EXTENSION_CONFIG_SECTION="svifpd",t.getConfiguration=r.configUtils.ConfigurationGetter(t.EXTENSION_CONFIG_SECTION)},1316:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.createDebugAdapterTracker=void 0;const o=i(n(2663)),a=n(4869),s=n(20),u=n(1700),c=n(2720),l=n(3107),f=n(8913),d=n(6822),p=n(3741),h=n(4030),g=n(8085);t.createDebugAdapterTracker=e=>{const t=(0,s.activeDebugSessionData)(e),n=t.debugVariablesTracker,i=o.default.get(c.WatchTreeProvider),v=t.currentPythonObjectsList,y=t.trackedPythonObjects,m=()=>r(void 0,void 0,void 0,(function*(){i.refresh()})),_=(0,u.debounce)((()=>r(void 0,void 0,void 0,(function*(){(0,a.logDebug)("Scope changed. Update current python objects list"),yield v.update(),yield m(),yield Promise.all([r(void 0,void 0,void 0,(function*(){o.default.get(h.WebviewClient).sendRequest(g.WebviewRequests.replaceData())})),(0,l.saveAllTrackedObjects)(y.allTracked,e)])}))),500);let b=!1;const w=(0,u.debounce)((()=>r(void 0,void 0,void 0,(function*(){if(b)return;b=!0;const t=yield(0,p.runSetup)(e);return b=!1,t}))),500);return{onWillStartSession:()=>{(0,a.logTrace)("onWillStartSession"),t.isStopped=!1},onWillStopSession:()=>r(void 0,void 0,void 0,(function*(){(0,a.logTrace)("onWillStopSession"),t.isStopped=!1,v.clear(),y.clear(),i.refresh()})),onWillReceiveMessage:e=>r(void 0,void 0,void 0,(function*(){if((0,a.logTrace)("onWillReceiveMessage",e),"request"===e.type&&"scopes"===e.command)n.onScopesRequest(e);else{if("request"===e.type&&"variables"===e.command)return n.onVariablesRequest(e);if("request"===e.type&&"evaluate"===e.command&&/^\s*$/.test(e.arguments.expression))return n.setFrameId(e.arguments.frameId)}})),onDidSendMessage:e=>r(void 0,void 0,void 0,(function*(){if((0,a.logTrace)("onDidSendMessage",e),"event"===e.type&&"stopped"===e.event&&void 0!==e.body.threadId)(0,a.logDebug)("Breakpoint hit"),t.isStopped=!0,yield w().then((e=>{if(!0===e)return _()}));else{if("response"===e.type&&"variables"===e.command)return!0===(0,f.getConfiguration)("addViewContextEntryToVSCodeDebugVariables")&&(0,d.patchDebugVariableContext)(e),n.onVariablesResponse(e),m();if("event"===e.type&&"continued"===e.event)return t.isStopped=!1,n.onContinued();"response"===e.type&&"scopes"===e.command&&(n.onScopesResponse(e),yield w().then((e=>{if(!0===e)return _()})))}})),onError:e=>{(0,a.logTrace)("onError",e)},onExit:()=>{(0,a.logTrace)("onExit"),t.isStopped=!1,v.clear(),y.clear(),i.refresh()}}}},6822:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return i(t,e),t},a=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.viewVariableFromVSCodeDebugViewAsImage=t.patchDebugVariableContext=t.updateDebugFrameId=void 0;const s=o(n(9496)),u=n(1091),c=n(5928);t.updateDebugFrameId=function(){return a(this,void 0,void 0,(function*(){const e=s.window.activeTextEditor;if(e){const t=e.selection;let n=null;for(let t=0;t<e.document.lineCount&&null===n;t++){const r=e.document.lineAt(t).text.search(/\s/);-1!==r&&(n=new s.Position(t,r))}if(null===n)return;e.selection=new s.Selection(n,n.translate({characterDelta:1})),yield s.commands.executeCommand("editor.debug.action.selectionToRepl",{}).then((()=>{e.selection=t}))}}))},t.patchDebugVariableContext=function(e){const t=["AxesSubplot","Figure"];e.body.variables.forEach((e=>{void 0!==e.type&&t.includes(e.type)&&(e.__vscodeVariableMenuContext="viewableInGraphicViewer")}))},t.viewVariableFromVSCodeDebugViewAsImage=function({variable:e}){return a(this,void 0,void 0,(function*(){const t=s.debug.activeDebugSession;if(void 0===t||void 0===e.evaluateName)return;const n=yield(0,u.findExpressionViewables)(e.evaluateName,t);return n.err||0===n.safeUnwrap().length?void 0:(0,c.viewObject)({variable:e.evaluateName},n.safeUnwrap()[0],t)}))}},6173:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DebugSessionData=void 0;const r=n(5376),i=n(3107),o=n(1115),a=n(8086);t.DebugSessionData=class{constructor(e){this.debugVariablesTracker=new a.DebugVariablesTracker,this.trackedPythonObjects=new i.TrackedPythonObjects,this.setupOkay=!1,this.isStopped=!1,this.savePathHelper=new o.SavePathHelper(e.id),this.currentPythonObjectsList=new r.CurrentPythonObjectsList(this.debugVariablesTracker,e)}}},20:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.activeDebugSessionData=void 0;const s=a(n(9496)),u=a(n(2663)),c=n(6173);let l=class{constructor(){this._debugSessions=new Map}debugSessionData(e){const t=e.id;if(!this._debugSessions.has(t)){const n=new c.DebugSessionData(e);this._debugSessions.set(t,n)}return this._debugSessions.get(t)}};l=o([(0,u.Service)()],l),t.activeDebugSessionData=function(e){return null!=e||(e=s.debug.activeDebugSession),e?u.default.get(l).debugSessionData(e):void 0}},8086:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.DebugVariablesTracker=void 0;const i=n(4869),o=n(2432),a=new Set([o.PYTHON_MODULE_NAME,"special variables","class variables","function variables"]),s=[/__pydevd_ret_val_dict.*/],u=new Set(["","module","function","dict","tuple","set","str","bytes","NoneType","int","float","bool","ZMQExitAutocall"]);t.DebugVariablesTracker=class{constructor(){this.localVariables=[],this.globalVariables=[],this.scopesRequests=new Map,this.frameForVariableReference=new Map,this.variablesRequests=new Map}currentFrameId(){return this._currentFrameId}setFrameId(e){this._currentFrameId=e}onScopesRequest(e){const t=e.seq,n=e.arguments.frameId;(0,i.logDebug)(`Captures scopes request ${t} with frameId ${n}`),this.scopesRequests.set(t,{frameId:n})}onScopesResponse(e){const t=this.scopesRequests.get(e.request_seq);if(void 0!==t){(0,i.logDebug)(`Captured scopes response ${e.request_seq} for frameId ${t.frameId}`);const n=t.frameId;this._currentFrameId=n,this.scopesRequests.delete(e.request_seq);const[r,o]=e.body.scopes;(0,i.logDebug)(`Local scope reference ${o.variablesReference}`),this.frameForVariableReference.set(o.variablesReference,{frameId:n,scope:"local"}),(0,i.logDebug)(`Global scope reference ${r.variablesReference}`),this.frameForVariableReference.set(r.variablesReference,{frameId:n,scope:"global"})}}onVariablesRequest(e){const t=this.frameForVariableReference.get(e.arguments.variablesReference);void 0!==t&&((0,i.logDebug)(`Captured variables request ${e.seq}, for variablesReference ${e.arguments.variablesReference}`),this.variablesRequests.set(e.seq,Object.assign({variablesReference:e.arguments.variablesReference},t)))}onVariablesResponse(e){var t,n;const r=this.variablesRequests.get(e.request_seq);if(void 0!==r){(0,i.logDebug)(`Captured variable response ${e.request_seq} For ${r.scope}, with ${e.body.variables.length} variables`);const o=r.frameId;this.variablesRequests.delete(e.request_seq),"local"===r.scope?this.localVariables.length=0:this.globalVariables.length=0;const c="local"===r.scope?this.localVariables:this.globalVariables;this._currentFrameId=o;for(const r of e.body.variables.filter((e=>!(a.has(e.name)||void 0!==e.type&&u.has(e.type)||s.some((t=>t.test(e.name))))))){const e=null!==(t=r.evaluateName)&&void 0!==t?t:r.name;(0,i.logDebug)(`Got variable ${e} for frame ${o}, of type ${r.type}.`),c.push({name:r.name,evaluateName:e,frameId:o,type:null!==(n=r.type)&&void 0!==n?n:"unknown"})}}}onContinued(){}getVariable(e){var t;return null!==(t=this.localVariables.find((t=>t.evaluateName===e)))&&void 0!==t?t:this.globalVariables.find((t=>t.evaluateName===e))}currentFrameVariables(){return r(this,void 0,void 0,(function*(){return{locals:this.localVariables.filter((e=>e.frameId===this._currentFrameId)),globals:this.globalVariables.filter((e=>e.frameId===this._currentFrameId))}}))}}},112:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return i(t,e),t},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.activate=void 0,n(8660);const s=o(n(9496)),u=n(4869),c=n(8329),l=n(1316),f=a(n(2663)),d=n(5099),p=n(3498),h=n(8913),g=n(5049),v=n(1115),y=n(1195),m=n(2720),_=n(20),b=n(1998),w=n(1700),O=n(6381),x=n(853),j=n(9904),P=n(4030),E=n(8085);function I(){(0,u.initLog)(),f.default.get(P.WebviewClient).sendRequest(E.WebviewRequests.configuration())}t.activate=function(e){f.default.set(P.WebviewClient,new P.WebviewClient(e)),I(),(0,u.logTrace)("Activating extension"),(0,O.setupPluginManager)(e),(0,v.setSaveLocation)(e),s.workspace.onDidChangeConfiguration((e=>{e.affectsConfiguration(h.EXTENSION_CONFIG_SECTION)&&I()})),(0,u.logDebug)("Registering debug adapter tracker for python"),s.debug.registerDebugAdapterTrackerFactory("python",{createDebugAdapterTracker:l.createDebugAdapterTracker}),(0,u.logDebug)("Registering debug adapter tracker for debugpy"),s.debug.registerDebugAdapterTrackerFactory("debugpy",{createDebugAdapterTracker:l.createDebugAdapterTracker}),(0,u.logDebug)("Registering debug adapter tracker for python-Jupyter"),s.debug.registerDebugAdapterTrackerFactory("Python Kernel Debug Adapter",{createDebugAdapterTracker:l.createDebugAdapterTracker});const t=f.default.get(d.AllViewables);e.subscriptions.push(...[t.addViewable(c.NumpyImage),t.addViewable(c.PillowImage),t.addViewable(y.PlotlyFigure),t.addViewable(y.PyplotFigure),t.addViewable(y.PyplotAxes),t.addViewable(b.NumpyTensor),t.addViewable(b.TorchTensor)].filter(w.hasValue)),(0,u.logDebug)("Registering code actions provider (the lightbulb)"),e.subscriptions.push(s.languages.registerCodeActionsProvider("python",new p.CodeActionProvider,{providedCodeActionKinds:[s.CodeActionKind.Empty]})),(0,u.logDebug)("Registering hover provider (for shape info)"),e.subscriptions.push(s.languages.registerHoverProvider("python",new x.HoverProvider)),(0,u.logDebug)("Registering image watch tree view provider"),e.subscriptions.push(s.window.registerTreeDataProvider("pythonDebugImageWatch",f.default.get(m.WatchTreeProvider)));const n=f.default.get(m.WatchTreeProvider);e.subscriptions.push(s.debug.onDidChangeActiveDebugSession((e=>{if(void 0!==e)return(0,_.activeDebugSessionData)(e).currentPythonObjectsList.update().then((()=>n.refresh()))}))),e.subscriptions.push(s.debug.onDidTerminateDebugSession((e=>(0,_.activeDebugSessionData)(e).savePathHelper.deleteSaveDir()))),e.subscriptions.push(...(0,g.registerExtensionCommands)(e));try{f.default.get(j.SocketServer).start()}catch(e){(0,u.logError)("Failed to start socket server",e)}}},1525:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return i(t,e),t},a=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.serializePythonObjectToDisk=void 0;const s=o(n(9496)),u=n(20),c=n(4869),l=n(7052),f=n(2432),d=n(3934),p=n(2127);t.serializePythonObjectToDisk=function(e,t,n,r){return a(this,void 0,void 0,(function*(){const i=(0,u.activeDebugSessionData)(n);r=null!=r?r:i.savePathHelper.savePathFor(e),(0,c.logDebug)(`Saving viewable of type ${t.type} to ${r}`);const o=(0,l.isExpressionSelection)(e)?e.expression:e.variable,a=`${r}${t.suffix}`,h=(0,f.constructValueWrappedExpressionFromEvalCode)(t.serializeObjectPythonCode,o,a),g=i.savePathHelper.mkdir();if(g.err){const e=`Failed to create directory for saving object: ${(0,p.errorMessage)(g)}`;return(0,c.logError)(e),void s.window.showErrorMessage(e)}const v=(0,p.joinResult)(yield(0,d.evaluateInPython)(h,n));if(!v.err)return a;{const e=`Error saving viewable of type ${t.type}: ${(0,p.errorMessage)(v)}`.replaceAll("\\n","\n");(0,c.logError)(e),s.window.showErrorMessage(e)}}))}},2211:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.serializeImageUsingSocketServer=t.serializePythonObjectUsingSocketServer=void 0;const o=n(4869),a=n(7052),s=n(2432),u=n(3934),c=i(n(2663)),l=n(9904),f=n(3099),d=n(3329),p=n(20),h=n(2127),g=n(9180),v={[g.ArrayDataType.UInt8]:"uint8",[g.ArrayDataType.UInt16]:"uint16",[g.ArrayDataType.UInt32]:"uint32",[g.ArrayDataType.Float32]:"float32",[g.ArrayDataType.Int8]:"int8",[g.ArrayDataType.Int16]:"int16",[g.ArrayDataType.Int32]:"int32",[g.ArrayDataType.Bool]:"bool",[g.ArrayDataType.Float64]:void 0,[g.ArrayDataType.Int64]:void 0,[g.ArrayDataType.UInt64]:void 0},y={[g.DimensionOrder.HWC]:"hwc",[g.DimensionOrder.CHW]:"chw"};function m(e,t,n){return r(this,void 0,void 0,(function*(){const r=c.default.get(l.SocketServer),i=(0,a.selectionString)(e),d=f.RequestsManager.randomRequestId(),p=(0,s.constructOpenSendAndCloseCode)(r.portNumber,d,i);(0,o.logDebug)("Sending code to python: ",p),(0,o.logDebug)("Sending request to python with reqId ",d);const g=new Promise((e=>{r.onResponse(d,((t,n)=>{(0,o.logDebug)("Received response from python with reqId ",d),e((0,h.Ok)({header:t,data:n}))}))})),v=(0,h.joinResult)(yield(0,u.evaluateInPython)(p,n));if(v.err){const e=`Error requesting viewable of type ${t.type}: ${(0,h.errorMessage)(v)}`.replaceAll("\\n","\n");return Promise.resolve((0,h.Err)(e))}return g}))}t.serializePythonObjectUsingSocketServer=m,t.serializeImageUsingSocketServer=function(e,t,n){var i,o,s;return r(this,void 0,void 0,(function*(){const r=yield m(e,t,n);if(r.err)return(0,h.Err)("Error retrieving image using socket");{const t=(0,a.selectionString)(e),{header:u,data:c}=r.safeUnwrap(),l=(0,d.parseMessage)(u,c);if(l.err)return l;const f=l.safeUnwrap();if(f.type===d.ObjectType.Exception){const e=`Exception: ${f.object.type}: ${f.object.message}`;return(0,h.Err)(e)}if(f.type!==d.ObjectType.NumpyArray){const e=`Expected array, got ${f.type}`;return(0,h.Err)(e)}const g=f.object,m=null!==(i=g.actualDataType)&&void 0!==i?i:g.dataType,_=v[m];if(void 0===_){const e=`Datatype ${m} not supported.`;return(0,h.Err)(e)}const b=4*g.dimensions.reduce(((e,t)=>e*t),1),w=new ArrayBuffer(b);new Uint8Array(w).set(g.data);const O=(0,p.activeDebugSessionData)(n),x=null===(s=null===(o=O.currentPythonObjectsList)||void 0===o?void 0:o.find(t))||void 0===s?void 0:s.InfoOrError;let j;if(j=void 0===x||x.err?{}:x.safeUnwrap()[1],void 0===y[g.dimensionOrder]){const e=`Data ordering ${g.dimensionOrder} not supported.`;return(0,h.Err)(e)}const P={image_id:t,value_variable_kind:(0,a.isExpressionSelection)(e)?"expression":"variable",expression:t,width:g.width,height:g.height,channels:g.channels,datatype:_,additional_info:j,min:g.mins,max:g.maxs,data_ordering:g.dimensionOrder,bytes:w};return(0,h.Ok)(P)}}))}},5888:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EXTENSION_NAME=void 0,t.EXTENSION_NAME="svifpd"},5376:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return i(t,e),t},s=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.removeAllExpressions=t.removeExpression=t.editExpression=t.addExpression=t.CurrentPythonObjectsList=t.globalExpressionsList=void 0;const u=a(n(2663)),c=a(n(9496)),l=n(20),f=n(4869),d=n(2432),p=n(3934),h=n(1091),g=n(1700),v=n(2127);let y=class{constructor(){this.expressions=[]}};function m(e){return Object.fromEntries(Object.entries(e).map((([e,t])=>{return[e,(n=t,n.startsWith('"')&&n.endsWith('"')&&n.length>1?n.slice(1,n.length-1):n)];var n})))}function _(e){const t=e.filter(v.isOkay).map((e=>e.safeUnwrap()));if(0===t.length)return(0,v.Err)("Invalid expression");{const e=t.flatMap((e=>"object"==typeof e&&null!==e?Object.entries(e):[])).map((([e,t])=>[e,JSON.stringify(t)])),n=Object.fromEntries(e);return(0,v.Ok)(n)}}y=o([(0,u.Service)()],y),t.globalExpressionsList=u.default.get(y).expressions,t.CurrentPythonObjectsList=class{constructor(e,t){this.debugVariablesTracker=e,this.debugSession=t,this._variablesList=[],this._expressionsInfo=[]}retrieveVariables(){return s(this,void 0,void 0,(function*(){const{locals:e,globals:t}=yield this.debugVariablesTracker.currentFrameVariables();return 0===t.length&&0===e.length?[]:(0,g.arrayUniqueByKey)([...t,...e],(e=>e.evaluateName)).map((e=>e.evaluateName))}))}retrieveInformation(){return s(this,void 0,void 0,(function*(){const e=this._variablesList.map((e=>e[0])),n=[...yield(0,h.findExpressionsViewables)(e,this.debugSession).then((t=>t.err?Array(e.length).fill(t):t.safeUnwrap().map((e=>(0,v.Ok)(e))))),...yield Promise.allSettled(t.globalExpressionsList.map((e=>(0,h.findExpressionViewables)(e,this.debugSession)))).then((e=>e.map((e=>"fulfilled"===e.status?e.value:(0,v.Err)(e.reason)))))].map((e=>e.ok?e.safeUnwrap().length>0?e:(0,v.Err)("Not viewable"):e)),r=n.map((e=>e.map((e=>e.map((e=>e.infoPythonCode)))))),i=[...e,...t.globalExpressionsList],o=(0,g.zip)(i,r).map((([e,t])=>t.map((t=>(0,d.constructRunSameExpressionWithMultipleEvaluatorsCode)(e,t))))),a=o.map(((e,t)=>[t,e])),s=a.map((([,e])=>e)).filter(v.isOkay).map((e=>e.safeUnwrap())),u=a.filter((([,e])=>e.ok)).map((([e])=>e)),c=(0,d.combineMultiEvalCodePython)(s),l=yield(0,p.evaluateInPython)(c,this.debugSession);if(l.err)return(0,f.logError)(`Error while retrieving information for variables and expressions: ${(0,v.errorMessage)(l)}`),{variables:[],expressions:[]};{const e=Object.fromEntries((0,g.zip)(u,l.safeUnwrap().map(_))),t=a.map((([t])=>o[t].ok?e[t]:o[t])),r=([e,t])=>{if(e.err)return e;if(t.err)return t;{const n=e.safeUnwrap();return(0,g.notEmptyArray)(n)?(0,v.Ok)([n,m(t.safeUnwrap())]):(0,v.Err)("Not viewable")}},i=(0,g.zip)(n,t).map(r);return{variables:i.slice(0,this._variablesList.length),expressions:i.slice(this._variablesList.length)}}}))}update(){return s(this,void 0,void 0,(function*(){const e=(0,l.activeDebugSessionData)(this.debugSession);if(!1===e.isStopped||!1===e.setupOkay)return;this._variablesList.length=0;const n=yield this.retrieveVariables();(0,f.logDebug)(`Got ${n.length} variables: ${n}`),this._variablesList.push(...n.map((e=>[e,(0,v.Err)("Not ready")])));const r=yield this.retrieveInformation(),i={};for(let e=0;e<this._variablesList.length;e++){const t=this._variablesList[e],n=t[0],o=r.variables[e];o.err?(0,f.logDebug)(`Error while getting information for variable '${n}': ${(0,v.errorMessage)(o)}`):((0,f.logDebug)(`Got information for variable '${n}': ${JSON.stringify(o.safeUnwrap()[1])}`),i[e]=t,i[e][1]=o)}this._variablesList.length=0,this._variablesList.push(...Object.values(i));const o=Object.keys(r.expressions).length;o===t.globalExpressionsList.length?this._expressionsInfo=Object.values(r.expressions):(0,f.logError)(`Unexpected number of expressions: ${o} (expected ${t.globalExpressionsList.length})`)}))}clear(){this._variablesList.length=0,this._expressionsInfo.length=0}get variablesList(){return this._variablesList}get expressionsInfo(){return 0===this._expressionsInfo.length?void 0:this._expressionsInfo}find(e){const n=this._variablesList.find((t=>t[0]===e));if(void 0!==n)return{type:"variable",InfoOrError:n[1]};{const n=t.globalExpressionsList.findIndex((t=>t===e));return n>=0?{type:"expression",InfoOrError:this._expressionsInfo[n]}:void 0}}addExpression(e){return u.default.get(y).expressions.push(e),this.update()}expressionsList({skipInvalid:e}){var n;const r=null!==(n=this.expressionsInfo)&&void 0!==n?n:Array(t.globalExpressionsList.length).fill((0,v.Err)("Not ready"));let i=(0,g.zip)(t.globalExpressionsList,r).map((([e,t])=>[e,t]));return e&&(i=i.filter((([,e])=>!e.err))),i}},t.addExpression=function(){return s(this,void 0,void 0,(function*(){const e=yield c.window.showInputBox({prompt:"Enter expression to watch",placeHolder:"e.g. images[0]",ignoreFocusOut:!0});return void 0!==e&&""!==e&&(u.default.get(y).expressions.push(e),!0)}))},t.editExpression=function(e){return s(this,void 0,void 0,(function*(){const t=u.default.get(y).expressions,n=t.indexOf(e);if(n>-1){const r=yield c.window.showInputBox({prompt:"Enter expression to watch",value:e,placeHolder:"e.g. images[0]",ignoreFocusOut:!0});if(void 0!==r)return t[n]=r,!0}return!1}))},t.removeExpression=function(e){const t=u.default.get(y).expressions,n=t.indexOf(e);return n>-1&&(t.splice(n,1),!0)},t.removeAllExpressions=function(){const e=u.default.get(y).expressions;if(e.length>0){const t=e.slice(0);return e.length=0,t}return[]}},3107:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return i(t,e),t},a=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.saveAllTrackedObjects=t.TrackedPythonObjects=void 0;const s=o(n(6005)),u=n(2432),c=n(3934),l=n(7052),f=n(1700),d=n(20),p=n(4869),h=n(2127);t.TrackedPythonObjects=class{constructor(){this.tracked=new Map}genTrackingId(e){return{id:s.createHash("md5").update(e.expression).digest("hex").toString()}}changeViewable(e,t){const n=this.tracked.get(e.id);void 0!==n&&this.tracked.set(e.id,Object.assign(Object.assign({},n),{viewable:t}))}track(e,t,n,r){return void 0===r&&(r=this.genTrackingId(e)),this.tracked.set(r.id,{expression:e,viewable:t,savePath:n}),r}untrack(e){this.tracked.delete(e.id)}trackingIdIfTracked(e){const t=this.genTrackingId(e);return this.tracked.has(t.id)?t:void 0}savePath(e){const t=this.tracked.get(e.id);return null==t?void 0:t.savePath}clear(){this.tracked.clear()}get allTracked(){return[...this.tracked.values()]}},t.saveAllTrackedObjects=function(e,t){return a(this,void 0,void 0,(function*(){const n=(0,d.activeDebugSessionData)(t);if(!1===n.setupOkay)return;const r=e.map((({expression:e,viewable:t,savePath:n})=>(0,u.constructValueWrappedExpressionFromEvalCode)(t.serializeObjectPythonCode,e.expression,`${n}${t.suffix}`))),i=(0,u.combineMultiEvalCodePython)(r),o=n.savePathHelper.mkdir();if(o.err)return void(0,p.logError)(`Failed to create directory for saving tracked objects: ${(0,h.errorMessage)(o)}`);const s=yield(0,c.evaluateInPython)(i,t);s.err?(0,p.logError)(`Failed to save tracked objects: ${(0,h.errorMessage)(s)}`):yield(0,f.allFulfilled)(e.map((e=>a(this,void 0,void 0,(function*(){const t=`${e.savePath}${e.viewable.suffix}`;void 0!==e.viewable.onShow?yield e.viewable.onShow(t):yield(0,l.openImageToTheSide)(t,!1)})))))}))}},3111:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return i(t,e),t},a=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.removeAllExpressionsTree=t.editExpressionTreeItem=t.removeExpressionTreeItem=t.addExpressionTreeItem=t.ExpressionWatchTreeItem=t.AddExpressionWatchTreeItem=void 0;const u=s(n(2663)),c=o(n(9496)),l=n(20),f=n(5376),d=n(3914),p=n(2720),h=n(4030),g=n(8085);class v extends c.TreeItem{constructor(e="Add Expression",t=c.TreeItemCollapsibleState.None){super(e,t),this.label=e,this.collapsibleState=t,this.command={command:"svifpd.add-expression",title:"Add Expression",tooltip:"Add Expression"}}}t.AddExpressionWatchTreeItem=new v;class y extends d.PythonObjectTreeItem{constructor(e,t,n,r=c.TreeItemCollapsibleState.Collapsed){super("expression",e,e,t,n,r),this.expression=e,this.updateContext()}}t.ExpressionWatchTreeItem=y,t.addExpressionTreeItem=function(){var e;return a(this,void 0,void 0,(function*(){(yield(0,f.addExpression)())&&(yield null===(e=(0,l.activeDebugSessionData)())||void 0===e?void 0:e.currentPythonObjectsList.update(),u.default.get(p.WatchTreeProvider).refresh(),u.default.get(h.WebviewClient).sendRequest(g.WebviewRequests.replaceData()))}))},t.removeExpressionTreeItem=function(e){var t,n;return a(this,void 0,void 0,(function*(){const r=e.expression;(yield(0,f.removeExpression)(r))&&(e.trackingId&&(null===(t=(0,l.activeDebugSessionData)())||void 0===t||t.trackedPythonObjects.untrack(e.trackingId)),yield null===(n=(0,l.activeDebugSessionData)())||void 0===n?void 0:n.currentPythonObjectsList.update(),u.default.get(p.WatchTreeProvider).refresh(),u.default.get(h.WebviewClient).sendRequest(g.WebviewRequests.replaceData()))}))},t.editExpressionTreeItem=function(e){var t;return a(this,void 0,void 0,(function*(){const n=e.expression;(yield(0,f.editExpression)(n))&&(yield null===(t=(0,l.activeDebugSessionData)())||void 0===t?void 0:t.currentPythonObjectsList.update(),u.default.get(p.WatchTreeProvider).refresh(),u.default.get(h.WebviewClient).sendRequest(g.WebviewRequests.replaceData()))}))},t.removeAllExpressionsTree=function(){var e,t;return a(this,void 0,void 0,(function*(){const n=(0,f.removeAllExpressions)();if(n.length>0){const r=null===(e=(0,l.activeDebugSessionData)())||void 0===e?void 0:e.trackedPythonObjects;void 0!==r&&n.forEach((e=>{const t=r.trackingIdIfTracked({expression:e});void 0!==t&&r.untrack(t)})),yield null===(t=(0,l.activeDebugSessionData)())||void 0===t?void 0:t.currentPythonObjectsList.update(),u.default.get(p.WatchTreeProvider).refresh(),u.default.get(h.WebviewClient).sendRequest(g.WebviewRequests.replaceData())}}))}},3914:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.PythonObjectInfoLineTreeItem=t.ErrorWatchTreeItem=t.PythonObjectTreeItem=void 0;const a=o(n(9496)),s=n(1700);var u;function c({viewables:e,trackingState:t,itemType:n,isError:r}){let i="svifpd:";return i+=t.toString(),r&&(i+="-errorItem"),e.length>0&&(i+="-"+(0,s.arrayUnique)(e.map((e=>e.group))).join("_")),"expression"===n&&(i+="-expressionItem"),i}!function(e){e.Tracked="trackedVariable",e.NotTracked="nonTrackedVariable"}(u||(u={}));class l extends a.TreeItem{constructor(e,t,n,r,i,o){super(t,o),this.itemType=e,this.expression=n,this.viewables=r,this.info=i,this.tracking=u.NotTracked,this.lastUsedViewable=r[0]}get trackingState(){return this.tracking}updateContext(){const e=c({trackingState:this.tracking,itemType:this.itemType,viewables:this.viewables,isError:!1});this.contextValue=e}setTracked(e){this.trackingId=e,this.tracking=u.Tracked,this.iconPath=new a.ThemeIcon("eye"),this.updateContext()}setNonTracked(){this.trackingId=void 0,this.tracking=u.NotTracked,this.iconPath=void 0,this.updateContext()}}t.PythonObjectTreeItem=l;class f extends a.TreeItem{constructor(e,t,n){super(e,a.TreeItemCollapsibleState.None),this.expression=e,this.itemType=n,this.description="string"==typeof t?t:t.message,this.updateContext()}updateContext(){const e=c({trackingState:u.NotTracked,itemType:this.itemType,viewables:[],isError:!0});this.contextValue=e}}t.ErrorWatchTreeItem=f;class d extends a.TreeItem{constructor(e,t){super(e,a.TreeItemCollapsibleState.None),this.label=e,this.description=t,this.contextValue=d.contextValue}}t.PythonObjectInfoLineTreeItem=d,d.contextValue="infoItem"},2720:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return i(t,e),t},s=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.WatchTreeProvider=void 0;const u=a(n(9496)),c=n(3111),l=n(2663),f=n(76),d=n(3914),p=n(20),h=n(5376),g=n(1700),v=n(2127);class y extends u.TreeItem{constructor(e,t,n=u.TreeItemCollapsibleState.Expanded){super(e,n),this.label=e,this.items=t,this.collapsibleState=n}}let m=class{constructor(){this._onDidChangeTreeData=new u.EventEmitter,this.onDidChangeTreeData=this._onDidChangeTreeData.event}refresh(e){this._onDidChangeTreeData.fire(e)}getTreeItem(e){return e}getChildren(e){var t,n,r;return s(this,void 0,void 0,(function*(){if(void 0===e){const e=(0,p.activeDebugSessionData)(),i=null!==(t=null==e?void 0:e.currentPythonObjectsList.variablesList.map((([e,t])=>t.err?new d.ErrorWatchTreeItem(e,(0,v.errorMessage)(t),"variable"):new f.VariableWatchTreeItem(e,t.safeUnwrap()[0],t.safeUnwrap()[1]))))&&void 0!==t?t:[],o=null!==(n=null==e?void 0:e.currentPythonObjectsList.expressionsInfo)&&void 0!==n?n:Array(h.globalExpressionsList.length).fill((0,v.Err)("Not ready")),a=(0,g.zip)(h.globalExpressionsList,o).map((([e,t])=>t.err?new d.ErrorWatchTreeItem(e,(0,v.errorMessage)(t),"expression"):new c.ExpressionWatchTreeItem(e,t.safeUnwrap()[0],t.safeUnwrap()[1]))),s=null===(r=(0,p.activeDebugSessionData)())||void 0===r?void 0:r.trackedPythonObjects;if(void 0!==s){const e=[...i,...a].filter((0,g.isOf)(f.VariableWatchTreeItem,c.ExpressionWatchTreeItem));for(const t of e){const e=s.trackingIdIfTracked({expression:t.expression});void 0!==e&&t.setTracked(e)}}return[new y("Variables",i),new y("Expressions",[...a,c.AddExpressionWatchTreeItem])]}return e instanceof y?e.items:e instanceof d.PythonObjectTreeItem?Object.entries(e.info).map((([e,t])=>new d.PythonObjectInfoLineTreeItem(e,t))):(c.AddExpressionWatchTreeItem,[])}))}};m=o([(0,l.Service)()],m),t.WatchTreeProvider=m},994:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return i(t,e),t},a=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.makeViewWatchTreeItemCommand=t.refreshWatchTree=t.untrackPythonObjectTreeItem=t.trackPythonObjectTreeItem=void 0;const u=o(n(9496)),c=s(n(2663)),l=n(20),f=n(2720),d=n(76),p=n(5928);function h(e,t){const n=(0,l.activeDebugSessionData)(t);let r;return e.trackingId&&(r=n.trackedPythonObjects.savePath(e.trackingId)),void 0===r&&(r=n.savePathHelper.savePathFor(e instanceof d.VariableWatchTreeItem?{variable:e.variableName}:{expression:e.expression})),r}t.trackPythonObjectTreeItem=function(e){const t=u.debug.activeDebugSession;if(void 0!==t){const n=(0,l.activeDebugSessionData)(t),r=h(e,t),i=n.trackedPythonObjects.track({expression:e.expression},e.lastUsedViewable,r,e.trackingId);e.setTracked(i),c.default.get(f.WatchTreeProvider).refresh(e)}},t.untrackPythonObjectTreeItem=function(e){var t;e.trackingId&&(null===(t=(0,l.activeDebugSessionData)())||void 0===t||t.trackedPythonObjects.untrack(e.trackingId)),e.setNonTracked(),c.default.get(f.WatchTreeProvider).refresh(e)},t.refreshWatchTree=function(){var e;return a(this,void 0,void 0,(function*(){yield null===(e=(0,l.activeDebugSessionData)())||void 0===e?void 0:e.currentPythonObjectsList.update(),c.default.get(f.WatchTreeProvider).refresh()}))},t.makeViewWatchTreeItemCommand=function(e){return t=>a(this,void 0,void 0,(function*(){const n=u.debug.activeDebugSession;void 0!==n&&((0,l.activeDebugSessionData)(n).isStopped?yield function(e,t,n){var r;return a(this,void 0,void 0,(function*(){const i=t.lastUsedViewable.group===e?t.lastUsedViewable:null!==(r=t.viewables.find((t=>t.group===e)))&&void 0!==r?r:t.lastUsedViewable;t.lastUsedViewable=i,t.trackingId&&(0,l.activeDebugSessionData)(n).trackedPythonObjects.changeViewable(t.trackingId,i);const o=h(t,n);return(0,p.viewObject)({expression:t.expression},i,n,o)}))}(e,t,n):u.window.showWarningMessage("Cannot view object while debugging is not paused."))}))}},76:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.VariableWatchTreeItem=void 0;const a=o(n(9496)),s=n(3914);class u extends s.PythonObjectTreeItem{constructor(e,t,n,r=a.TreeItemCollapsibleState.Collapsed){super("variable",e,e,t,n,r),this.variableName=e,this.updateContext()}}t.VariableWatchTreeItem=u},6381:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return i(t,e),t},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.registerPlugin=t.disablePluginCommand=t.setupPluginManager=t.PluginManager=void 0;const c=a(n(9496)),l=n(4869),f=a(n(2663)),d=n(8913),p=n(5099),h=n(3741),g=n(1700);let v=class{constructor(e,t=[]){this._allowPluginPermanently=e,this._allowedPlugins=[],this._plugins=[],this._disposables=[],this._allowedPlugins.push(...t)}allowPlugin(e){this.isPluginAllowed(e)||this._allowedPlugins.push(e)}allowPluginPermanently(e){return u(this,void 0,void 0,(function*(){yield this._allowPluginPermanently(e),this.allowPlugin(e)}))}isPluginAllowed(e){return this._allowedPlugins.includes(e)}addPlugin(e,t){this.isPluginAllowed(e.extensionId)&&(this._plugins.push(e),this._disposables.push(t))}disablePlugin(e){const t=this._plugins.indexOf(e);t>-1&&this._plugins.splice(t,1);const n=this._disposables[t];void 0!==n&&(n.dispose(),this._disposables.splice(t,1))}get plugins(){return this._plugins}dispose(){this._disposables.forEach((e=>e.dispose()))}};function y(e,...t){return u(this,void 0,void 0,(function*(){return c.window.showInformationMessage(`A plugin has asked to register a view: ${e.extensionId}. It add the feature to view and track ${e.title} objects. Ignoring this message would not activate this plugin.`,...t)}))}var m;function _(e){const t=f.default.get(p.AllViewables).addViewable(e);if(void 0!==t)return f.default.get(v).addPlugin(e,t),{success:!0,disposable:t}}v=o([(0,f.Service)(),s("design:paramtypes",[Function,Array])],v),t.PluginManager=v,t.setupPluginManager=function(e){const t="allowedPlugins",n=e.globalState.get(t,[]),r=c.extensions.all.map((e=>e.id)),i=n.filter((e=>r.includes(e)));i.length!==n.length&&e.globalState.update(t,i),(0,l.logDebug)("Allowed plugins",i),f.default.set(v,new v((n=>u(this,void 0,void 0,(function*(){(0,l.logDebug)("Allowing plugin permanently",n);const r=e.globalState.get(t,[]);return e.globalState.update(t,(0,g.arrayUnique)([...r,n]))}))),i)),e.subscriptions.push(f.default.get(v))},t.disablePluginCommand=function(){return u(this,void 0,void 0,(function*(){const e=f.default.get(v),t=yield c.window.showQuickPick(e.plugins.map((e=>({label:e.title,detail:`(by ${e.extensionId})`,plugin:e}))),{canPickMany:!0,title:"Select plugins to disable"});if(void 0!==t&&0!==t.length){for(const n of t)e.disablePlugin(n.plugin);(0,h.setSetupIsNotOkay)()}}))},function(e){e.OkayDoNotShowAgain="Okay, Do not show again",e.OkayUntilRestart="Okay (until restart)",e.ViewCode="View Code",e.DisablePlugin="Disable Plugin"}(m||(m={})),t.registerPlugin=function(e){var t,n;return u(this,void 0,void 0,(function*(){if(!1===(0,d.getConfiguration)("allowPlugins",void 0,!0))return{success:!1};const r=f.default.get(v);if(r.isPluginAllowed(e.extensionId))return(0,l.logDebug)("Plugin is allowed",e),null!==(t=_(e))&&void 0!==t?t:{success:!1};(0,l.logInfo)("Registering view",e);let i=yield y(e,m.OkayDoNotShowAgain,m.OkayUntilRestart,m.ViewCode,m.DisablePlugin);if(void 0===i||i===m.DisablePlugin)return{success:!1};if(i===m.ViewCode&&(i=yield function(e){return u(this,void 0,void 0,(function*(){const t=`plugin-${e.extensionId}.py`,n=c.Uri.file(t).with({scheme:"untitled",path:t}),r=yield c.workspace.openTextDocument(n),i=yield c.window.showTextDocument(r),o=e=>"#".repeat(e.length+4)+"\n"+`# ${e} #\n`+"#".repeat(e.length+4);return yield i.edit((t=>t.insert(new c.Position(0,0),[o(`Plugin ${e.extensionId}`),"",o("Setup Code"),e.setupPythonCode.setupCode(),"",o("Test Setup Code"),e.setupPythonCode.testSetupCode,"",o("Test Object Type Code"),e.testTypePythonCode.evalCode("x")+"  # x is some variable from your code","",o("Retrieve Information Code"),e.infoPythonCode.evalCode("x")+"  # x is some variable from your code","",o("Save Object Code"),e.serializeObjectPythonCode.evalCode("x","path")+"  # x is some variable from your code, path is the path to save the object to",""].join("\n")))),y(e,m.OkayDoNotShowAgain,m.OkayUntilRestart,m.DisablePlugin)}))}(e)),i===m.OkayDoNotShowAgain)r.allowPluginPermanently(e.extensionId);else{if(i!==m.OkayUntilRestart)return{success:!1};r.allowPlugin(e.extensionId)}return(0,l.logDebug)("Registering view",e),null!==(n=_(e))&&void 0!==n?n:{success:!1}}))}},2432:function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.constructOpenSendAndCloseCode=t.constructObjectShapeCode=t.combineMultiEvalCodePython=t.constructRunSameExpressionWithMultipleEvaluatorsCode=t.constructValueWrappedExpressionFromEvalCode=t.viewablesSetupCode=t.moduleSetupCode=t.verifyModuleExistsCode=t.atModule=t.convertBoolToPython=t.stringifyPython=t.PYTHON_MODULE_NAME=void 0;const i=r(n(3217)),o=r(n(102)),a=r(n(2663)),s=n(5099),u=n(1700);t.PYTHON_MODULE_NAME="_python_view_image_mod";const c=`${t.PYTHON_MODULE_NAME}_setup_result`,l=`${t.PYTHON_MODULE_NAME}.same_value_multiple_callables`,f=`${t.PYTHON_MODULE_NAME}.eval_into_value`,d=`${t.PYTHON_MODULE_NAME}.stringify`,p=`${t.PYTHON_MODULE_NAME}.object_shape_if_it_has_one`,h=`${t.PYTHON_MODULE_NAME}.open_send_and_close`,g=`\ntry:\n    ${t.PYTHON_MODULE_NAME}\nexcept:\n    \n    from types import ModuleType\n    ${t.PYTHON_MODULE_NAME} = ModuleType('python_view_image_mod', '')\n    try:\n        exec('''${i.default}''', ${t.PYTHON_MODULE_NAME}.__dict__)\n    except Exception as e:\n        ${c} = e\n        del ${t.PYTHON_MODULE_NAME}\n\n    try:\n        exec('''${o.default}''', ${t.PYTHON_MODULE_NAME}.__dict__)\n    except:\n        pass\n`;function v(e){return`[${e.join(", ")}]`}function y(e){const n=e.map((({setupCode:e,testSetupCode:n,id:r})=>{return i=t.PYTHON_MODULE_NAME,o=e(),a=n,s=r,`\nexec('''\ntry:\n${(0,u.indent)(a,4)}\nexcept:\n    try:\n${(0,u.indent)(o,8)}\n    except Exception as e:\n        ${s} = { 'error': e }\n''', ${i}.__dict__\n)\n`;var i,o,a,s})).join("\n\n");return`\n${g}\n\n${n}\n`}function m(e){if(e.includes("\n"))throw new Error("Expression must be a single line");return{pythonCode:`${f}(lambda: ${e})`}}t.stringifyPython=function(e){return{pythonCode:`${d}(${e.pythonCode})`}},t.convertBoolToPython=function(e){return e?"True":"False"},t.atModule=function(e){return`${t.PYTHON_MODULE_NAME}.${e}`},t.verifyModuleExistsCode=function(){return{pythonCode:`"Value({})".format('${t.PYTHON_MODULE_NAME}' in globals() or '${t.PYTHON_MODULE_NAME}' in locals())`}},t.moduleSetupCode=function(){return{pythonCode:g}},t.viewablesSetupCode=function(){return{pythonCode:y(a.default.get(s.AllViewables).allViewables.map((e=>e.setupPythonCode)))}},t.constructValueWrappedExpressionFromEvalCode=function(e,t,...n){return m(e.evalCode(t,...n))},t.constructRunSameExpressionWithMultipleEvaluatorsCode=function(e,t){const n=`lambda: ${e}`,r=v(t.map((({evalCode:e})=>`lambda x: ${e("x")}`)));return{pythonCode:`${l}(${n}, ${r})`}},t.combineMultiEvalCodePython=function(e){return{pythonCode:v(e.map((({pythonCode:e})=>e)))}},t.constructObjectShapeCode=function(e){return m(`${p}(${e})`)},t.constructOpenSendAndCloseCode=function(e,t,n){return m(`${h}(${e}, ${t}, ${n})`)}},4499:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.parsePythonResult=void 0;const a=o(n(8546)),s=n(2127),u=e=>e.sepBy(a.string(",").trim(a.optWhitespace)).wrap(a.string("["),a.string("]")),c=a.createLanguage({Quote:e=>a.oneOf("'\""),Tuple:e=>e.PythonValue.sepBy(a.string(",").trim(a.optWhitespace)).wrap(a.string("("),a.string(")")),List:e=>u(e.PythonValue),String:e=>e.Quote.chain((e=>a.takeWhile((t=>t!==e)).skip(a.string(e)))),None:e=>a.string("None").result(null),Boolean:e=>a.alt(a.string("True").result(!0),a.string("False").result(!1)),Integer:e=>a.regexp(/[0-9]+/).map((e=>parseInt(e,10))),KeyValue:e=>a.seqObj(["key",e.String],a.string(":").trim(a.optWhitespace),["value",e.PythonValue]),Dict:e=>e.KeyValue.sepBy(a.string(",").trim(a.optWhitespace)).wrap(a.string("{").trim(a.optWhitespace),a.string("}").trim(a.optWhitespace)).map((e=>Object.fromEntries(e.map((e=>[e.key,e.value]))))),PythonValue:e=>a.alt(e.Tuple,e.String,e.Dict,e.List,e.None,e.Boolean,e.Integer),Error:e=>a.seqObj(a.string("Error"),a.string("(").trim(a.optWhitespace),["error",e.String],a.string(")").trim(a.optWhitespace)),Value:e=>a.seqObj(a.string("Value"),a.string("(").trim(a.optWhitespace),["result",e.PythonValue],a.string(")").trim(a.optWhitespace)),ValidPythonResult:e=>a.alt(e.Error.map((({error:e})=>(0,s.Err)(e))),e.Value.map((({result:e})=>(0,s.Ok)(e))),e.None.map((()=>(0,s.Ok)(null))),u(e.ValidPythonResult)),ValidPythonResultStringified:e=>e.Quote.chain((t=>e.ValidPythonResult.skip(a.string(t))))});t.parsePythonResult=function(e){const t=c.ValidPythonResultStringified.parse(e);return t.status?(0,s.Ok)(t.value):(0,s.Err)(t.expected[0])}},3934:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.evaluateInPython=t.execInPython=t.runPython=void 0;const i=n(20),o=n(2432),a=n(4499),s=n(2127);function u(e,t,n,o){return r(this,void 0,void 0,(function*(){try{const r=yield function(e,t,{context:n,frameId:r}){const o=(0,i.activeDebugSessionData)(e).debugVariablesTracker;return r=null!=r?r:o.currentFrameId(),e.customRequest("evaluate",{expression:t,frameId:r,context:n})}(n,e.pythonCode,o);return t?(0,a.parsePythonResult)(r.result):(0,s.Ok)(null)}catch(e){return e instanceof Error?e.message.includes("SyntaxError")?(0,s.Err)("Syntax error"):(0,s.Err)(e.message):(0,s.Err)(JSON.stringify(e))}}))}t.runPython=u,t.execInPython=function(e,t,n={context:"repl"}){return u({pythonCode:`\nexec("""\n${e.pythonCode}\n"""\n)\n`},!1,t,n)},t.evaluateInPython=function(e,t,n={context:"repl"}){return u((0,o.stringifyPython)(e),!0,t,n)}},3741:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.runSetup=t.setSetupIsNotOkay=void 0;const i=n(20),o=n(4869),a=n(1700),s=n(2432),u=n(3934),c=n(2127);t.setSetupIsNotOkay=function(){(0,o.logTrace)("Manual set 'setup is not okay'");const e=(0,i.activeDebugSessionData)();void 0!==e&&(e.setupOkay=!1)},t.runSetup=function(e,t){return r(this,void 0,void 0,(function*(){const n=(0,i.activeDebugSessionData)(e);let l=5;const f=()=>r(this,void 0,void 0,(function*(){let i;if(!0===t)i=!1,t=!1,(0,o.logDebug)("Force run setup");else{(0,o.logDebug)("Check setup is okay or not");const t=yield function(e){return r(this,void 0,void 0,(function*(){const t=yield(0,u.runPython)((0,s.verifyModuleExistsCode)(),!0,e,{context:"repl"});return(0,c.joinResult)(t)}))}(e);t.err?((0,o.logDebug)("Setup check failed",t.val),i=!1):!1===t.safeUnwrap()?((0,o.logDebug)("Setup check succeeded, but no setup"),i=!1):((0,o.logDebug)("Setup check succeeded, setup is okay"),i=!0)}if(!1===i){if(l<=0)throw new Error("Setup failed");return n.setupOkay=!1,l-=1,(0,o.logDebug)("Running setup... tries left:",l),(0,o.logDebug)("Run module setup code"),yield(0,u.execInPython)((0,s.moduleSetupCode)(),e),(0,o.logDebug)("Run viewables setup code"),yield(0,u.execInPython)((0,s.viewablesSetupCode)(),e),d()}return n.setupOkay=!0,!0})),d=(0,a.debounce)(f,250);return f()}))}},1653:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StatefulBufferReader=void 0,t.StatefulBufferReader=class{constructor(e){this.buffer=e,this.functions={readUInt8:[1,Buffer.prototype.readUInt8],readUInt16:[2,Buffer.prototype.readUInt16BE],readUInt32:[4,Buffer.prototype.readUInt32BE],readFloat32:[4,Buffer.prototype.readFloatBE],readFloat64:[8,Buffer.prototype.readDoubleBE],readInt8:[1,Buffer.prototype.readInt8],readInt32:[4,Buffer.prototype.readInt32BE],readInt16:[2,Buffer.prototype.readInt16BE]}}get currentBuffer(){return this.buffer}read([e,t]){const n=t.call(this.buffer,0),r=this.buffer.subarray(e);return this.buffer=r,n}readUInt8(){return this.read(this.functions.readUInt8)}readUInt32(){return this.read(this.functions.readUInt32)}readFloat32(){return this.read(this.functions.readFloat32)}readFloat64(){return this.read(this.functions.readFloat64)}readInt8(){return this.read(this.functions.readInt8)}readInt32(){return this.read(this.functions.readInt32)}readInt16(){return this.read(this.functions.readInt16)}readString(){const e=this.readUInt32(),t=this.buffer.toString("utf-8",0,e),n=this.buffer.subarray(e);return this.buffer=n,t}}},1104:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StatefulBufferWriter=void 0,t.StatefulBufferWriter=class{constructor(e){this.buffer=e,this.functions={writeUInt8:[1,Buffer.prototype.writeUInt8],writeUInt16:[2,Buffer.prototype.writeUInt16BE],writeUInt32:[4,Buffer.prototype.writeUInt32BE],writeFloat32:[4,Buffer.prototype.writeFloatBE],writeFloat64:[8,Buffer.prototype.writeDoubleBE],writeInt8:[1,Buffer.prototype.writeInt8],writeInt32:[4,Buffer.prototype.writeInt32BE],writeInt16:[2,Buffer.prototype.writeInt16BE]}}get currentBuffer(){return this.buffer}writer([e,t]){return n=>{const r=t.call(this.buffer,n),i=this.buffer.subarray(e);return this.buffer=i,r}}writeUInt8(e){return this.writer(this.functions.writeUInt8)(e)}writeUInt32(e){return this.writer(this.functions.writeUInt32)(e)}writeFloat32(e){return this.writer(this.functions.writeFloat32)(e)}writeFloat64(e){return this.writer(this.functions.writeFloat64)(e)}writeInt8(e){return this.writer(this.functions.writeInt8)(e)}writeInt32(e){return this.writer(this.functions.writeInt32)(e)}writeInt16(e){return this.writer(this.functions.writeInt16)(e)}}},1366:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MessageChunks=void 0;const r=n(4869);t.MessageChunks=class{constructor(e,t){this.expectedMessageLength=e,this.expectedChunkCount=t,this.messageHeaders=[],this.messageLength=0,this.messageChunks=new Array(t).fill(null),this.messageHeaders=new Array(t).fill(null)}addChunk(e,t){var n;const{chunkNumber:i,chunkCount:o,chunkLength:a,messageLength:s}=e;if(o!==this.expectedChunkCount)throw new Error(`(reqId ${e.requestId}) Expected chunk count ${this.expectedChunkCount} but got ${o}`);if(s!==this.expectedMessageLength)throw new Error(`(reqId ${e.requestId}) Expected message length ${this.expectedMessageLength} but got ${s}`);if(i>=this.expectedChunkCount)throw new Error(`(reqId ${e.requestId}) Chunk number ${i} is out of bounds (chunk count is ${o})`);if(a!==t.length)throw new Error(`(reqId ${e.requestId}) Chunk length ${a} does not match chunk length ${t.length}`);const u=this.messageHeaders[i];if(null!==u){if(u.messageID!==e.messageID||u.chunkCount!==e.chunkCount||u.chunkLength!==e.chunkLength||u.messageLength!==e.messageLength||u.requestId!==e.requestId||u.sender!==e.sender||u.messageType!==e.messageType)throw new Error(`(reqId ${e.requestId}) Chunk number ${i} already exists. current: ${JSON.stringify(this.messageHeaders[i])}`);return void(0,r.logDebug)(`(reqId ${e.requestId}) Got the same chunk twice. Chunk number: ${i}. Ignoring.`)}const c=this.messageChunks[i];if(null!==c){if(c.equals(t))return void(0,r.logDebug)(`(reqId ${e.requestId}) Got the same chunk twice. Chunk number: ${i}. Ignoring.`);throw new Error(`(reqId ${e.requestId}) Chunk number ${i} already exists. current with length: ${null===(n=this.messageChunks[i])||void 0===n?void 0:n.length}`)}this.messageChunks[i]=t,this.messageHeaders[i]=e,this.messageLength+=a}isComplete(){return this.messageLength===this.expectedMessageLength&&this.messageChunks.every((e=>null!==e))}fullMessage(){if(!this.isComplete())throw new Error("Message is not complete");return Buffer.concat(this.messageChunks)}}},3099:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RequestsManager=void 0,t.RequestsManager=class{constructor(){this.requests=new Map}static randomRequestId(){return Math.floor(Math.random()*Math.pow(2,32))}hasRequest(e){return this.requests.has(e)}subscribeRequest(e,t){this.requests.set(e,t)}unsubscribeRequest(e){this.requests.delete(e)}onData(e,t){const{requestId:n}=e,r=this.requests.get(n);r&&r(e,t)}}},9904:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return i(t,e),t},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.setDefault=t.SocketServer=void 0;const c=n(2663),l=a(n(1808)),f=n(3099),d=n(3329),p=n(1366),h=n(4869),g=Buffer.alloc(0);let v=class{constructor(){this.port=void 0,this.started=!1,this.outgoingRequestsManager=new f.RequestsManager,this.chunksByMessageId=new Map,this.server=l.createServer({allowHalfOpen:!0,pauseOnConnect:!1,keepAlive:!0}),this.server.on("connection",this.onClientConnected.bind(this))}start(){return u(this,void 0,void 0,(function*(){if(this.started)throw new Error("SocketServer already started");this.server.listen(0);const e=this.server.address();if("string"==typeof e)throw new Error("SocketServer address is a string");if(null===e)throw new Error("SocketServer address is null");this.port=e.port,(0,h.logInfo)("SocketServer started on port "+this.port),this.started=!0}))}get isListening(){return this.server.listening}get portNumber(){if(!this.started)throw new Error("SocketServer is not started");if(void 0===this.port)throw new Error("SocketServer is not listening");return this.port}onClientConnected(e){const t=this.outgoingRequestsManager,n=(e,n)=>{(0,h.logTrace)("Received message from client. Request id:",e.requestId),t.hasRequest(e.requestId)&&t.onData(e,n)};let r=Buffer.alloc(0);var i;e.on("data",(i=e=>{for((0,h.logTrace)(`Received ${e.length} bytes from client`);r.length>0||e.length>0;){if(r.length>0){const t=Buffer.concat([r,e]);r=g,e=t}const t=(0,d.splitHeaderContentRest)(e);if(t.err)return(0,h.logTrace)("Waiting for more data"),void(r=e);const[i,o,a]=t.safeUnwrap();a.length>0&&((0,h.logTrace)("Received more data than expected"),r=a),(0,h.logTrace)("Parsed header",i),e=g;const s=y(this.chunksByMessageId,i.messageID,(()=>new p.MessageChunks(i.messageLength,i.chunkCount)));if(s.addChunk(i,o),s.isComplete()){(0,h.logTrace)("Message is complete");const e=s.fullMessage();n(i,e)}}},(...e)=>{try{i(...e)}catch(e){(0,h.logDebug)("Error in handler"),(0,h.logDebug)(e)}})),e.on("close",(()=>{(0,h.logTrace)("Client closed connection")})),e.on("end",(()=>{(0,h.logTrace)("Client ended connection")})),e.on("error",(e=>{(0,h.logDebug)("Client connection error"),(0,h.logDebug)(e)}))}onResponse(e,t){this.outgoingRequestsManager.subscribeRequest(e,((n,r)=>{this.outgoingRequestsManager.unsubscribeRequest(e),t(n,r)}))}};function y(e,t,n){return e.has(t)||e.set(t,n()),e.get(t)}v=o([(0,c.Service)(),s("design:paramtypes",[])],v),t.SocketServer=v,t.setDefault=y},3329:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseMessage=t.composeHelloMessage=t.randomMessageId=t.splitHeaderContentRest=t.ObjectType=t.MessageType=t.Sender=t.HEADER_LENGTH=void 0;const r=n(2127),i=n(1653),o=n(1104),a=n(9180);var s,u,c,l,f,d;function p(e){switch(e){case l.Float32:return a.ArrayDataType.Float32;case l.Float64:return a.ArrayDataType.Float64;case l.Int8:return a.ArrayDataType.Int8;case l.Int16:return a.ArrayDataType.Int16;case l.Int32:return a.ArrayDataType.Int32;case l.Int64:return a.ArrayDataType.Int64;case l.Uint8:return a.ArrayDataType.UInt8;case l.Uint16:return a.ArrayDataType.UInt16;case l.Uint32:return a.ArrayDataType.UInt32;case l.Uint64:return a.ArrayDataType.UInt64;case l.Bool:return a.ArrayDataType.Bool;case l.Undefined:throw new Error("Undefined datatype. This function should not be called with this value.")}}function h(e){switch(e){case f.HWC:return a.DimensionOrder.HWC;case f.CHW:return a.DimensionOrder.CHW}}function g(){return Math.floor(Math.random()*Math.pow(2,32))}t.HEADER_LENGTH=Object.entries({messageLength:4,messageID:4,sender:1,requestId:4,messageType:1,chunkCount:4,chunkNumber:4,chunkLength:4}).reduce(((e,[t,n])=>e+n),0),(d=t.Sender||(t.Sender={}))[d.Server=1]="Server",d[d.Python=2]="Python",function(e){e[e.PythonSendingObject=1]="PythonSendingObject"}(s=t.MessageType||(t.MessageType={})),function(e){e[e.NumpyArray=1]="NumpyArray",e[e.Exception=255]="Exception"}(u=t.ObjectType||(t.ObjectType={})),function(e){e[e.LittleEndian=1]="LittleEndian",e[e.BigEndian=2]="BigEndian"}(c||(c={})),function(e){e[e.Undefined=0]="Undefined",e[e.Float32=1]="Float32",e[e.Float64=2]="Float64",e[e.Int8=3]="Int8",e[e.Int16=4]="Int16",e[e.Int32=5]="Int32",e[e.Int64=6]="Int64",e[e.Uint8=7]="Uint8",e[e.Uint16=8]="Uint16",e[e.Uint32=9]="Uint32",e[e.Uint64=10]="Uint64",e[e.Bool=11]="Bool"}(l||(l={})),function(e){e[e.HWC=1]="HWC",e[e.CHW=2]="CHW"}(f||(f={})),t.splitHeaderContentRest=function(e){if(e.length<t.HEADER_LENGTH)return(0,r.Err)(`Buffer shorter than header length: ${e.length} < ${t.HEADER_LENGTH}`);const n=new i.StatefulBufferReader(e),o=n.readUInt32(),a=n.readUInt32(),s=n.readUInt8(),u=n.readUInt32(),c=n.readUInt8(),l=n.readUInt32(),f=n.readUInt32(),d=n.readUInt32(),p={messageLength:o,messageID:a,sender:s,requestId:u,messageType:c,chunkCount:l,chunkNumber:f,chunkLength:d},h=e.subarray(t.HEADER_LENGTH);if(h.length<d)return(0,r.Err)(`Buffer shorter than chunk length: ${h.length} < ${d}`);if(h.length>d){const e=h.subarray(d);return(0,r.Ok)([p,h.subarray(0,d),e])}return(0,r.Ok)([p,h,Buffer.alloc(0)])},t.randomMessageId=g,t.composeHelloMessage=function(e,n){const r=t.HEADER_LENGTH,i=g(),a=s.PythonSendingObject,u=Buffer.alloc(r),c=new o.StatefulBufferWriter(u);return c.writeUInt32(r),c.writeUInt32(i),c.writeUInt8(n),c.writeUInt32(e),c.writeUInt8(a),c.writeUInt32(1),c.writeUInt32(0),c.writeUInt32(0),u},t.parseMessage=function(e,t){const{messageType:n}=e;if(n===s.PythonSendingObject)return function(e){const t=new i.StatefulBufferReader(e),n=t.readUInt8();switch(n){case u.NumpyArray:return function(e){try{const t=new i.StatefulBufferReader(e),n=t.readUInt8(),o=t.readUInt8(),a=t.readUInt8(),s=t.readUInt8(),u=[];for(let e=0;e<s;e++)u.push(t.readUInt32());const c=t.readUInt32(),f=t.readUInt32(),d=t.readUInt32(),g=t.readUInt8(),v=t.readUInt8(),y=[];for(let e=0;e<v;e++)y.push(t.readFloat32());const m=[];for(let e=0;e<v;e++)m.push(t.readFloat32());const _=t.currentBuffer;return(0,r.Ok)({dataType:p(n),actualDataType:o===l.Undefined?void 0:p(o),byteOrder:a,dimensions:u,width:c,height:f,channels:d,dimensionOrder:h(g),mins:y,maxs:m,data:_})}catch(e){return(0,r.errorFromUnknown)(e)}}(t.currentBuffer).map((e=>({type:n,object:e})));case u.Exception:return function(e){try{const t=new i.StatefulBufferReader(e),n=t.readString(),o=t.readString();return(0,r.Ok)({type:n,message:o})}catch(e){return(0,r.errorFromUnknown)(e)}}(t.currentBuffer).map((e=>({type:n,object:e})));default:throw new Error("Unknown object type: "+n)}}(t);throw new Error(`Unknown message type ${n}`)}},2127:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.isOkay=t.errorMessage=t.joinResult=t.errorFromUnknown=t.Err=t.Ok=void 0;const a=o(n(2831));var s=n(2831);Object.defineProperty(t,"Ok",{enumerable:!0,get:function(){return s.Ok}}),Object.defineProperty(t,"Err",{enumerable:!0,get:function(){return s.Err}}),t.errorFromUnknown=function(e){return e instanceof Error?a.Err(e):a.Err(JSON.stringify(e))},t.joinResult=function(e){return e.ok?e.safeUnwrap():e},t.errorMessage=function(e){return"string"==typeof e.val?e.val:e.val.message},t.isOkay=function(e){return e.ok}},1700:function(e,t){"use strict";var n=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.setDefault=t.notEmptyArray=t.hasValue=t.isOf=t.zip=t.debounce=t.arrayUniqueByKey=t.arrayUnique=t.indent=t.allFulfilled=void 0,t.allFulfilled=function(e){const t={},n=e=>e!==t;return Promise.all(e.map((e=>e.catch((e=>t))))).then((e=>e.filter(n)))},t.indent=function(e,t){return e.split("\n").map((e=>" ".repeat(t)+e)).join("\n")},t.arrayUnique=function(e){return[...new Set(e)]},t.arrayUniqueByKey=function(e,t){return[...new Map(e.map((e=>[t(e),e]))).values()]},t.debounce=function(e,t){let r;return(...i)=>(clearTimeout(r),new Promise((o=>{r=setTimeout((()=>n(this,void 0,void 0,(function*(){const t=yield e(...i);o(t)}))),t)})))},t.zip=function(...e){const t=Math.min(...e.map((e=>e.length))),n=[];for(let r=0;r<t;r++)n.push(e.map((e=>e[r])));return n},t.isOf=function(...e){return t=>e.some((e=>t instanceof e))},t.hasValue=function(e){return null!=e},t.notEmptyArray=function(e){return 0!==e.length},t.setDefault=function(e,t,n){return e.has(t)||e.set(t,n),e.get(t)}},7052:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return i(t,e),t},a=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.openImageToTheSide=t.currentUserSelection=t.selectionString=t.isExpressionSelection=void 0;const s=o(n(9496));function u(e){return"expression"in e}t.isExpressionSelection=u,t.selectionString=function(e){return u(e)?e.expression:e.variable},t.currentUserSelection=function(e,t){const n=e.getText(t);if(""!==n)return{expression:n};const r=e.getText(e.getWordRangeAtPosition(t.start));return""!==r?{variable:r}:void 0},t.openImageToTheSide=function(e,t){return a(this,void 0,void 0,(function*(){const n={viewColumn:s.ViewColumn.Beside,preview:t,preserveFocus:!0};return s.commands.executeCommand("vscode.open",s.Uri.file(e),n)}))}},8329:function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.PillowImage=t.NumpyImage=void 0;const i=r(n(3358)),o=r(n(4071)),a=n(8913),s=n(2432);t.NumpyImage={group:"image",type:"numpy_image",title:"Image",setupPythonCode:{setupCode:()=>o.default,testSetupCode:"(is_numpy_image, numpy_image_info, numpy_image_save)",id:"numpy_image"},testTypePythonCode:{evalCode:e=>{var t;return`${(0,s.atModule)("is_numpy_image")}(${e}, restrict_types=${(0,s.convertBoolToPython)(null!==(t=(0,a.getConfiguration)("restrictImageTypes"))&&void 0!==t&&t)})`}},infoPythonCode:{evalCode:e=>`${(0,s.atModule)("numpy_image_info")}(${e})`},serializeObjectPythonCode:{evalCode:(e,t)=>`${(0,s.atModule)("numpy_image_save")}('${t}', ${e}, backend='${(0,a.getConfiguration)("preferredBackend",void 0,a.Backends.Standalone)}', preprocess='${(0,a.getConfiguration)("normalizationMethod",void 0,a.NormalizationMethods.None)}')`},suffix:".png",supportsImageViewer:!0},t.PillowImage={group:"image",type:"pillow_image",title:"Image",setupPythonCode:{setupCode:()=>i.default,testSetupCode:"(is_pillow_image, pillow_image_info, pillow_image_save)",id:"pillow_image"},testTypePythonCode:{evalCode:e=>`${(0,s.atModule)("is_pillow_image")}(${e})`},infoPythonCode:{evalCode:e=>`${(0,s.atModule)("pillow_image_info")}(${e})`},serializeObjectPythonCode:{evalCode:(e,t)=>`${(0,s.atModule)("pillow_image_save")}('${t}', ${e})`},suffix:".png",supportsImageViewer:!0}},1195:function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.PyplotAxes=t.PyplotFigure=t.PlotlyFigure=void 0;const i=r(n(8140)),o=r(n(7661)),a=n(2432),s=n(8913);t.PlotlyFigure={group:"plot",type:"plotly_figure",title:"Figure (plotly)",setupPythonCode:{setupCode:()=>o.default,testSetupCode:"is_plotly_figure, plotly_figure_info, plotly_figure_save",id:"plotly_figure"},testTypePythonCode:{evalCode:e=>`${(0,a.atModule)("is_plotly_figure")}(${e})`},infoPythonCode:{evalCode:e=>`${(0,a.atModule)("plotly_figure_info")}(${e})`},serializeObjectPythonCode:{evalCode:(e,t)=>`${(0,a.atModule)("plotly_figure_save")}('${t}', ${e})`},suffix:".png",supportsImageViewer:!1},t.PyplotFigure={group:"plot",type:"pyplot_figure",title:"Figure (pyplot)",setupPythonCode:{setupCode:()=>{var e;return i.default+`\nset_matplotlib_agg(${(0,a.convertBoolToPython)(null!==(e=(0,s.getConfiguration)("matplotlibUseAgg"))&&void 0!==e&&e)})`},testSetupCode:"is_pyplot_figure, pyplot_figure_info, pyplot_figure_save",id:"pyplot_figure"},testTypePythonCode:{evalCode:e=>`${(0,a.atModule)("is_pyplot_figure")}(${e})`},infoPythonCode:{evalCode:e=>`${(0,a.atModule)("pyplot_figure_info")}(${e})`},serializeObjectPythonCode:{evalCode:(e,t)=>`${(0,a.atModule)("pyplot_figure_save")}('${t}', ${e})`},suffix:".png",supportsImageViewer:!1},t.PyplotAxes={group:"plot",type:"pyplot_axes",title:"Axes (pyplot)",setupPythonCode:{setupCode:()=>{var e;return i.default+`\nset_matplotlib_agg(${(0,a.convertBoolToPython)(null!==(e=(0,s.getConfiguration)("matplotlibUseAgg"))&&void 0!==e&&e)})`},testSetupCode:"is_pyplot_ax, pyplot_ax_info, pyplot_ax_save",id:"pyplot_axes"},testTypePythonCode:{evalCode:e=>`${(0,a.atModule)("is_pyplot_ax")}(${e})`},infoPythonCode:{evalCode:e=>`${(0,a.atModule)("pyplot_ax_info")}(${e})`},serializeObjectPythonCode:{evalCode:(e,t)=>`${(0,a.atModule)("pyplot_ax_save")}('${t}', ${e})`},suffix:".png",supportsImageViewer:!1}},1998:function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.TorchTensor=t.NumpyTensor=void 0;const i=r(n(2244)),o=r(n(7694)),a=n(2432);t.NumpyTensor={group:"tensor",type:"numpy_tensor",title:"Tensor (numpy)",setupPythonCode:{setupCode:()=>i.default,testSetupCode:"is_numpy_tensor, numpy_tensor_info, numpy_tensor_save",id:"numpy_tensor"},testTypePythonCode:{evalCode:e=>`${(0,a.atModule)("is_numpy_tensor")}(${e})`},infoPythonCode:{evalCode:e=>`${(0,a.atModule)("numpy_tensor_info")}(${e})`},serializeObjectPythonCode:{evalCode:(e,t)=>`${(0,a.atModule)("numpy_tensor_save")}('${t}', ${e})`},suffix:".png",supportsImageViewer:!1},t.TorchTensor={group:"tensor",type:"torch_tensor",title:"Tensor (torch)",setupPythonCode:{setupCode:()=>o.default,testSetupCode:"is_torch_tensor, torch_tensor_info, torch_tensor_save",id:"torch_tensor"},testTypePythonCode:{evalCode:e=>`${(0,a.atModule)("is_torch_tensor")}(${e})`},infoPythonCode:{evalCode:e=>`${(0,a.atModule)("torch_tensor_info")}(${e})`},serializeObjectPythonCode:{evalCode:(e,t)=>`${(0,a.atModule)("torch_tensor_save")}('${t}', ${e})`},suffix:".png",supportsImageViewer:!1}},4030:function(e,t,n){"use strict";var r,i=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&i(t,e,n);return o(t,e),t},u=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.WebviewClient=void 0,s(n(9496));const l=n(2663),f=n(8783),d=n(4869);let p=r=class{constructor(e){this.context=e,this.isReady=!1}static randomMessageId(){return Math.random().toString(36).substring(2,15)}setWebview(e){this.webview=e}setReady(){this.isReady=!0}unsetWebview(){this.webview=void 0,this.isReady=!1}reveal(){return c(this,void 0,void 0,(function*(){f.ImageViewPanel.render(this.context);let e=100;for(;!this.isReady&&e>0;)yield new Promise((e=>setTimeout(e,100))),e--}))}sendToWebview(e){if(void 0!==this.webview)return(0,d.logTrace)(`message: ${JSON.stringify(e)}`),this.webview.postMessage(e)}sendRequest(e){const t={id:r.randomMessageId(),message:Object.assign({kind:"Request"},e)};this.sendToWebview(t)}sendResponse(e,t){const n={id:e,message:Object.assign({kind:"Response"},t)};this.sendToWebview(n)}};p=r=a([(0,l.Service)(),u("design:paramtypes",[Object])],p),t.WebviewClient=p},8085:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebviewResponses=t.WebviewRequests=void 0;const r=n(8913),i=n(20),o=n(1700);function a(e,t,n){if(!t.err&&t.safeUnwrap()[0].filter((e=>e.supportsImageViewer)).length>0)return{image_id:e,expression:e,value_variable_kind:n,width:0,height:0,channels:1,datatype:"float32",additional_info:t.safeUnwrap()[1],max:null,min:null,bytes:null,data_ordering:"hwc"}}function s(){var e,t,n,r;const s=null===(e=(0,i.activeDebugSessionData)())||void 0===e?void 0:e.currentPythonObjectsList,u=null!==(t=null==s?void 0:s.variablesList.map((([e,t])=>a(e,t,"variable"))).filter(o.hasValue))&&void 0!==t?t:[],c=null!==(r=null===(n=null==s?void 0:s.expressionsList({skipInvalid:!0}))||void 0===n?void 0:n.map((([e,t])=>a(e,t,"expression"))).filter(o.hasValue))&&void 0!==r?r:[];return u.concat(c)}t.WebviewRequests=class{static replaceData(){return{type:"ReplaceData",replacement_images:s()}}static configuration(){var e;return{type:"Configuration",invert_scroll_direction:null!==(e=(0,r.getConfiguration)("viewerUi.invertMouseWheelZoom"))&&void 0!==e?e:null}}},t.WebviewResponses=class{static showImage(e){return{type:"ShowImage",image_data:e,options:{}}}static imagesObjects(){return{type:"ReplaceData",replacement_images:s()}}static imageData(e){return Object.assign({type:"ImageData"},e)}}},8783:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return i(t,e),t},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ImageViewPanel=void 0;const s=n(9496),u=o(n(7147)),c=o(n(1017)),l=n(2491),f=n(4542),d=n(6235),p=a(n(2663)),h=n(4030);class g{constructor(e,t,n){this._disposables=[],this._panel=e,this._panel.onDidDispose((()=>this.dispose()),null,this._disposables),this._panel.webview.html=this._getWebviewContent(this._panel.webview,t),this._webviewMessageHandler=new d.WebviewMessageHandler,p.default.get(h.WebviewClient).setWebview(this._panel.webview),this._panel.webview.onDidReceiveMessage(this._webviewMessageHandler.onWebviewMessage,this._webviewMessageHandler,n.subscriptions)}static render(e){const t=e.extensionUri;if(g.currentPanel)g.currentPanel._panel.reveal(s.ViewColumn.Beside);else{const n=s.window.createWebviewPanel("image-view","Image View",s.ViewColumn.Beside,{enableScripts:!0,localResourceRoots:[s.Uri.joinPath(t,"dist")]});g.currentPanel=new g(n,t,e)}}dispose(){for(g.currentPanel=void 0,p.default.get(h.WebviewClient).unsetWebview(),this._panel.dispose();this._disposables.length;){const e=this._disposables.pop();e&&e.dispose()}}_getWebviewContent(e,t){const n=(0,l.getUri)(e,t,["dist"]),r=(0,f.getNonce)();return u.readFileSync(c.join(t.fsPath,"dist","index.html"),"utf8").replaceAll(/\${nonce}/g,r).replaceAll(/\${webviewCspSource}/g,e.cspSource).replaceAll(/\${baseUri}/g,n.toString()).replaceAll(/<script.*?src="webview\.js"><\/script>/g,(()=>`<script type="module" defer src="${n}/webview.js" nonce=${r}><\/script>`))}}t.ImageViewPanel=g},6235:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return i(t,e),t},a=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.WebviewMessageHandler=void 0;const u=o(n(9496)),c=n(1091),l=n(4869),f=n(2211),d=s(n(2663)),p=n(4030),h=n(8085),g=n(2127),v=n(20),y=n(5376),m=n(2720);t.WebviewMessageHandler=class{constructor(){this.client=d.default.get(p.WebviewClient)}handleImagesRequest(e){this.client.sendResponse(e,h.WebviewResponses.imagesObjects())}handleImageDataRequest(e,t){var n,r,i;return a(this,void 0,void 0,(function*(){const o=u.debug.activeDebugSession;if(void 0===o)return;const a=null===(n=(0,v.activeDebugSessionData)(o))||void 0===n?void 0:n.currentPythonObjectsList,s=null!==(i=null===(r=a.find(t.expression))||void 0===r?void 0:r.type)&&void 0!==i?i:"expression",d=yield(0,c.findExpressionViewables)(t.expression,o);if(d.err||0===d.safeUnwrap().length)return;const p=yield(0,f.serializeImageUsingSocketServer)("variable"===s?{variable:t.expression}:{expression:t.expression},d.safeUnwrap()[0],o);p.err?(0,l.logError)("Error retrieving image using socket",(0,g.errorMessage)(p)):this.client.sendResponse(e,h.WebviewResponses.imageData(p.safeUnwrap()))}))}handleWebviewReady(e){return a(this,void 0,void 0,(function*(){this.client.setReady(),this.client.sendRequest(h.WebviewRequests.configuration()),this.client.sendResponse(e,h.WebviewResponses.imagesObjects())}))}handleAddExpression(e){var t;return a(this,void 0,void 0,(function*(){(yield(0,y.addExpression)())&&(yield null===(t=(0,v.activeDebugSessionData)())||void 0===t?void 0:t.currentPythonObjectsList.update(),d.default.get(m.WatchTreeProvider).refresh(),this.client.sendResponse(e,h.WebviewResponses.imagesObjects()))}))}handleEditExpression(e,{expression:t}){var n;return a(this,void 0,void 0,(function*(){(yield(0,y.editExpression)(t))&&(yield null===(n=(0,v.activeDebugSessionData)())||void 0===n?void 0:n.currentPythonObjectsList.update(),d.default.get(m.WatchTreeProvider).refresh(),this.client.sendResponse(e,h.WebviewResponses.imagesObjects()))}))}onWebviewMessage(e){return a(this,void 0,void 0,(function*(){(0,l.logTrace)("Received message from webview",e);const{id:t,message:n}=e,r=n.type;switch((0,l.logTrace)("Received message type",r),r){case"WebviewReady":return this.handleWebviewReady(t);case"RequestImages":return this.handleImagesRequest(t);case"RequestImageData":return this.handleImageDataRequest(t,n);case"AddExpression":return this.handleAddExpression(t);case"EditExpression":return this.handleEditExpression(t,n);default:(e=>{throw new Error(`Unknown message type: ${r}`)})()}}))}}},4542:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getNonce=void 0,t.getNonce=function(){let e="";const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let n=0;n<32;n++)e+=t.charAt(Math.floor(Math.random()*t.length));return e}},2491:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getUri=void 0;const r=n(9496);t.getUri=function(e,t,n){return e.asWebviewUri(r.Uri.joinPath(t,...n))}},2831:(e,t,n)=>{"use strict";function r(e){var t=String(e);if("[object Object]"===t)try{t=JSON.stringify(e)}catch(e){}return t}n.r(t),n.d(t,{Err:()=>c,ErrImpl:()=>u,None:()=>i,Ok:()=>f,OkImpl:()=>l,Option:()=>o,Result:()=>s,Some:()=>a});var i=new(function(){function e(){this.some=!1,this.none=!0}return e.prototype[Symbol.iterator]=function(){return{next:function(){return{done:!0,value:void 0}}}},e.prototype.unwrapOr=function(e){return e},e.prototype.expect=function(e){throw new Error(""+e)},e.prototype.unwrap=function(){throw new Error("Tried to unwrap None")},e.prototype.map=function(e){return this},e.prototype.andThen=function(e){return this},e.prototype.toResult=function(e){return c(e)},e.prototype.toString=function(){return"None"},e}());Object.freeze(i);var o,a=function(){function e(t){if(!(this instanceof e))return new e(t);this.some=!0,this.none=!1,this.val=t}return e.prototype[Symbol.iterator]=function(){var e=Object(this.val);return Symbol.iterator in e?e[Symbol.iterator]():{next:function(){return{done:!0,value:void 0}}}},e.prototype.unwrapOr=function(e){return this.val},e.prototype.expect=function(e){return this.val},e.prototype.unwrap=function(){return this.val},e.prototype.map=function(e){return a(e(this.val))},e.prototype.andThen=function(e){return e(this.val)},e.prototype.toResult=function(e){return f(this.val)},e.prototype.safeUnwrap=function(){return this.val},e.prototype.toString=function(){return"Some("+r(this.val)+")"},e.EMPTY=new e(void 0),e}();!function(e){e.all=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=[],r=0,i=e;r<i.length;r++){var o=i[r];if(!o.some)return o;n.push(o.val)}return a(n)},e.any=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=0,r=e;n<r.length;n++){var o=r[n];return o.some,o}return i},e.isOption=function(e){return e instanceof a||e===i}}(o||(o={}));var s,u=function(){function e(t){if(!(this instanceof e))return new e(t);this.ok=!1,this.err=!0,this.val=t;var n=(new Error).stack.split("\n").slice(2);n&&n.length>0&&n[0].includes("ErrImpl")&&n.shift(),this._stack=n.join("\n")}return e.prototype[Symbol.iterator]=function(){return{next:function(){return{done:!0,value:void 0}}}},e.prototype.else=function(e){return e},e.prototype.unwrapOr=function(e){return e},e.prototype.expect=function(e){throw new Error(e+" - Error: "+r(this.val)+"\n"+this._stack)},e.prototype.unwrap=function(){throw new Error("Tried to unwrap Error: "+r(this.val)+"\n"+this._stack)},e.prototype.map=function(e){return this},e.prototype.andThen=function(e){return this},e.prototype.mapErr=function(e){return new c(e(this.val))},e.prototype.toOption=function(){return i},e.prototype.toString=function(){return"Err("+r(this.val)+")"},Object.defineProperty(e.prototype,"stack",{get:function(){return this+"\n"+this._stack},enumerable:!1,configurable:!0}),e.EMPTY=new e(void 0),e}(),c=u,l=function(){function e(t){if(!(this instanceof e))return new e(t);this.ok=!0,this.err=!1,this.val=t}return e.prototype[Symbol.iterator]=function(){var e=Object(this.val);return Symbol.iterator in e?e[Symbol.iterator]():{next:function(){return{done:!0,value:void 0}}}},e.prototype.else=function(e){return this.val},e.prototype.unwrapOr=function(e){return this.val},e.prototype.expect=function(e){return this.val},e.prototype.unwrap=function(){return this.val},e.prototype.map=function(e){return new f(e(this.val))},e.prototype.andThen=function(e){return e(this.val)},e.prototype.mapErr=function(e){return this},e.prototype.toOption=function(){return a(this.val)},e.prototype.safeUnwrap=function(){return this.val},e.prototype.toString=function(){return"Ok("+r(this.val)+")"},e.EMPTY=new e(void 0),e}(),f=l;!function(e){e.all=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=[],r=0,i=e;r<i.length;r++){var o=i[r];if(!o.ok)return o;n.push(o.val)}return new f(n)},e.any=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=[],r=0,i=e;r<i.length;r++){var o=i[r];if(o.ok)return o;n.push(o.val)}return new c(n)},e.wrap=function(e){try{return new f(e())}catch(e){return new c(e)}},e.wrapAsync=function(e){try{return e().then((function(e){return new f(e)})).catch((function(e){return new c(e)}))}catch(e){return Promise.resolve(new c(e))}},e.isResult=function(e){return e instanceof c||e instanceof f}}(s||(s={}))},2663:(e,t,n)=>{"use strict";n.r(t),n.d(t,{CannotInjectValueError:()=>h,CannotInstantiateValueError:()=>u,Container:()=>d,ContainerInstance:()=>f,Inject:()=>y,InjectMany:()=>v,Service:()=>m,ServiceNotFoundError:()=>a,Token:()=>i,default:()=>_});var r,i=function(e){this.name=e},o=(r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},r(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),a=function(e){function t(t){var n,r=e.call(this)||this;return r.name="ServiceNotFoundError",r.normalizedIdentifier="<UNKNOWN_IDENTIFIER>","string"==typeof t?r.normalizedIdentifier=t:t instanceof i?r.normalizedIdentifier="Token<"+(t.name||"UNSET_NAME")+">":t&&(t.name||(null===(n=t.prototype)||void 0===n?void 0:n.name))&&(r.normalizedIdentifier="MaybeConstructable<"+t.name+">"||0),r}return o(t,e),Object.defineProperty(t.prototype,"message",{get:function(){return'Service with "'+this.normalizedIdentifier+'" identifier was not found in the container. Register it before usage via explicitly calling the "Container.set" function or using the "@Service()" decorator.'},enumerable:!1,configurable:!0}),t}(Error),s=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),u=function(e){function t(t){var n,r=e.call(this)||this;return r.name="CannotInstantiateValueError",r.normalizedIdentifier="<UNKNOWN_IDENTIFIER>","string"==typeof t?r.normalizedIdentifier=t:t instanceof i?r.normalizedIdentifier="Token<"+(t.name||"UNSET_NAME")+">":t&&(t.name||(null===(n=t.prototype)||void 0===n?void 0:n.name))&&(r.normalizedIdentifier="MaybeConstructable<"+t.name+">"||0),r}return s(t,e),Object.defineProperty(t.prototype,"message",{get:function(){return'Cannot instantiate the requested value for the "'+this.normalizedIdentifier+"\" identifier. The related metadata doesn't contain a factory or a type to instantiate."},enumerable:!1,configurable:!0}),t}(Error),c=Symbol("EMPTY_VALUE"),l=function(){return l=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},l.apply(this,arguments)},f=function(){function e(e){this.services=[],this.id=e}return e.prototype.has=function(e){return!!this.findService(e)},e.prototype.get=function(e){var t=d.of(void 0),n=t.findService(e),r=this.findService(e);if(n&&!0===n.global)return this.getServiceValue(n);if(r)return this.getServiceValue(r);if(n&&this!==t){var i=l({},n);i.value=c,this.set(i);var o=this.getServiceValue(i);return this.set(l(l({},i),{value:o})),o}if(n)return this.getServiceValue(n);throw new a(e)},e.prototype.getMany=function(e){var t=this;return this.findAllServices(e).map((function(e){return t.getServiceValue(e)}))},e.prototype.set=function(e,t){var n=this;if(e instanceof Array)return e.forEach((function(e){return n.set(e)})),this;if("string"==typeof e||e instanceof i)return this.set({id:e,type:null,value:t,factory:void 0,global:!1,multiple:!1,eager:!1,transient:!1});if("function"==typeof e)return this.set({id:e,type:e,value:t,factory:void 0,global:!1,multiple:!1,eager:!1,transient:!1});var r=l({id:new i("UNREACHABLE"),type:null,factory:void 0,value:c,global:!1,multiple:!1,eager:!1,transient:!1},e),o=this.findService(r.id);return o&&!0!==o.multiple?Object.assign(o,r):this.services.push(r),r.eager&&this.get(r.id),this},e.prototype.remove=function(e){var t=this;return Array.isArray(e)?e.forEach((function(e){return t.remove(e)})):this.services=this.services.filter((function(n){return n.id!==e||(t.destroyServiceInstance(n),!1)})),this},e.prototype.reset=function(e){var t=this;switch(void 0===e&&(e={strategy:"resetValue"}),e.strategy){case"resetValue":this.services.forEach((function(e){return t.destroyServiceInstance(e)}));break;case"resetServices":this.services.forEach((function(e){return t.destroyServiceInstance(e)})),this.services=[];break;default:throw new Error("Received invalid reset strategy.")}return this},e.prototype.findAllServices=function(e){return this.services.filter((function(t){return t.id===e}))},e.prototype.findService=function(e){return this.services.find((function(t){return t.id===e}))},e.prototype.getServiceValue=function(e){var t,n=c;if(e.value!==c)return e.value;if(!e.factory&&!e.type)throw new u(e.id);if(e.factory)if(e.factory instanceof Array){var r=void 0;try{r=this.get(e.factory[0])}catch(t){if(!(t instanceof a))throw t;r=new e.factory[0]}n=r[e.factory[1]](this,e.id)}else n=e.factory(this,e.id);if(!e.factory&&e.type){var i=e.type,o=(null===(t=Reflect)||void 0===t?void 0:t.getMetadata("design:paramtypes",i))||[],s=this.initializeParams(i,o);s.push(this),n=new(i.bind.apply(i,function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),i=0;for(t=0;t<n;t++)for(var o=arguments[t],a=0,s=o.length;a<s;a++,i++)r[i]=o[a];return r}([void 0],s)))}if(e.transient||n===c||(e.value=n),n===c)throw new u(e.id);return e.type&&this.applyPropertyHandlers(e.type,n),n},e.prototype.initializeParams=function(e,t){var n=this;return t.map((function(t,r){var i=d.handlers.find((function(t){return(t.object===e||t.object===Object.getPrototypeOf(e))&&t.index===r}));return i?i.value(n):t&&t.name&&!n.isPrimitiveParamType(t.name)?n.get(t):void 0}))},e.prototype.isPrimitiveParamType=function(e){return["string","boolean","number","object"].includes(e.toLowerCase())},e.prototype.applyPropertyHandlers=function(e,t){var n=this;d.handlers.forEach((function(r){"number"!=typeof r.index&&(r.object.constructor===e||e.prototype instanceof r.object.constructor)&&r.propertyName&&(t[r.propertyName]=r.value(n))}))},e.prototype.destroyServiceInstance=function(e,t){if(void 0===t&&(t=!1),t||e.type||e.factory){if("function"==typeof(null==e?void 0:e.value).destroy)try{e.value.destroy()}catch(e){}e.value=c}},e}(),d=function(){function e(){}return e.of=function(e){if(void 0===e&&(e="default"),"default"===e)return this.globalInstance;var t=this.instances.find((function(t){return t.id===e}));return t||(t=new f(e),this.instances.push(t)),t},e.has=function(e){return this.globalInstance.has(e)},e.get=function(e){return this.globalInstance.get(e)},e.getMany=function(e){return this.globalInstance.getMany(e)},e.set=function(e,t){return this.globalInstance.set(e,t),this},e.remove=function(e){return this.globalInstance.remove(e),this},e.reset=function(e){if(void 0===e&&(e="default"),"default"==e)this.globalInstance.reset(),this.instances.forEach((function(e){return e.reset()}));else{var t=this.instances.find((function(t){return t.id===e}));t&&(t.reset(),this.instances.splice(this.instances.indexOf(t),1))}return this},e.registerHandler=function(e){return this.handlers.push(e),this},e.import=function(e){return this},e.handlers=[],e.globalInstance=new f("default"),e.instances=[],e}(),p=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),h=function(e){function t(t,n){var r=e.call(this)||this;return r.target=t,r.propertyName=n,r.name="CannotInjectValueError",r}return p(t,e),Object.defineProperty(t.prototype,"message",{get:function(){return'Cannot inject value into "'+this.target.constructor.name+"."+this.propertyName+"\". Please make sure you setup reflect-metadata properly and you don't use interfaces without service tokens as injection value."},enumerable:!1,configurable:!0}),t}(Error);function g(e,t,n,r){var o;if((e&&"string"==typeof e||e instanceof i)&&(o={eagerType:e,lazyType:function(){return e}}),e&&"function"==typeof e&&(o={eagerType:null,lazyType:function(){return e()}}),!e&&n){var a=Reflect.getMetadata("design:type",t,n);o={eagerType:a,lazyType:function(){return a}}}if(!e&&"number"==typeof r&&Number.isInteger(r)){var s=Reflect.getMetadata("design:paramtypes",t,n),u=null==s?void 0:s[r];o={eagerType:u,lazyType:function(){return u}}}return o}function v(e){return function(t,n,r){var i=g(e,t,n,r);if(void 0===i||void 0===i.eagerType||i.eagerType===Object)throw new h(t,n);d.registerHandler({object:t,propertyName:n,index:r,value:function(e){var r=i.lazyType();if(void 0===r||r===Object)throw new h(t,n);return e.getMany(r)}})}}function y(e){return function(t,n,r){var i=g(e,t,n,r);if(void 0===i||void 0===i.eagerType||i.eagerType===Object)throw new h(t,n);d.registerHandler({object:t,propertyName:n,index:r,value:function(e){var r=i.lazyType();if(void 0===r||r===Object)throw new h(t,n);return e.get(r)}})}}function m(e){return function(t){var n={id:t,type:t,factory:void 0,multiple:!1,global:!1,eager:!1,transient:!1,value:c};e instanceof i||"string"==typeof e?n.id=e:e&&(n.id=e.id||t,n.factory=e.factory||void 0,n.multiple=e.multiple||!1,n.global=e.global||!1,n.eager=e.eager||!1,n.transient=e.transient||!1),d.set(n)}}const _=d},3210:(e,t,n)=>{"use strict";t.__esModule=!0,t.VSCodeConfigurations=t.ConfigurationSetter=t.ConfigurationInspector=t.ConfigurationGetter=void 0;var r=n(9496);function i(e){return function(t,n,i){return r.workspace.getConfiguration(e,n).get(t,i)}}function o(e){return function(t,n){return r.workspace.getConfiguration(e,n).inspect(t)}}function a(e){return function(t,n,i,o,a){return r.workspace.getConfiguration(e,i).update(t,n,o,a)}}t.ConfigurationGetter=i,t.ConfigurationInspector=o,t.ConfigurationSetter=a;var s=function(){function e(e){this.section=e,this._get=i(e),this._update=a(e),this._inspect=o(e)}return e.prototype.update=function(e,t,n,r,i){return this._update(e,t,n,r,i)},e.prototype.inspect=function(e){return this._inspect(e)},e.prototype.get=function(e,t,n){return this._get(e,t,n)},e}();t.VSCodeConfigurations=s},899:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return i(t,e),t};t.__esModule=!0,t.configUtils=void 0,t.configUtils=o(n(3210))},3217:e=>{"use strict";e.exports='def keyvalue(pair):\n    key, value = pair\n    return f"{stringify(key)}: {stringify(value)}"\n\n\ndef sanitize(s):\n    # s.replace(\\"\'\\", \\"\\\\\'\\").replace(\'\\"\', \'\\\\\\"\')\n    return s.replace("\'", "").replace(\'"\', \'\')\n\n\ndef stringify(value):\n    if isinstance(value, list):\n        return f"[{\',\'.join(map(stringify, value))}]"\n    elif isinstance(value, tuple):\n        return f"({\',\'.join(map(stringify, value))})"\n    elif isinstance(value, dict):\n        return f"{{{ \',\'.join(map(keyvalue, value.items())) }}}"\n    elif isinstance(value, str):\n        if value.startswith("Value(") or value.startswith("Error("):\n            return value  # keep Value/Error without wrapping quoted\n        else:\n            return f\'"{sanitize(value)}"\'\n    elif isinstance(value, Exception):\n        return f\'"{type(value).__name__}: {sanitize(str(value))}"\'\n    else:\n        return str(value)\n\n\ndef eval_into_value(func):\n    try:\n        return f"Value({stringify(func())})"\n    except Exception as e:\n        return f"Error({stringify(e)})"\n\n\ndef same_value_multiple_callables(get_value, funcs):\n    try:\n        val = get_value()\n        return [eval_into_value(lambda: f(val)) for f in funcs]\n    except Exception as e:\n        return [f"Error({stringify(e)})"] * len(funcs)\n\n\ndef object_shape_if_it_has_one(obj):\n    if hasattr(obj, "shape"):\n        shape = obj.shape\n        return tuple(shape)\n    elif hasattr(obj, "width") and hasattr(obj, "height") and hasattr(obj, "getbands"):\n        bands = "".join(map(str, obj.getbands()))\n        return {"width": obj.width, "height": obj.height, "channels": bands}\n    else:\n        return None\n'},4071:e=>{"use strict";e.exports='try:\n    import numpy as np\n\n    def numpy():\n        def is_numpy_image(img, restrict_types):\n            if restrict_types:\n                try:\n                    return isinstance(img, np.ndarray)\n                except TypeError:\n                    return False\n            else:\n                try:\n                    img = np.asarray(img)\n                    is_image = (img.ndim == 2) or (\n                        # hwc or chw\n                        img.ndim == 3 and (img.shape[2] <= 4 or img.shape[0] <= 4)\n                    )\n                    return is_image\n                except:\n                    return False\n\n        def info(img):\n            obj_type = type(img).__name__\n            try:\n                img = np.asarray(img)\n                shape = str(img.shape)\n                dtype = str(img.dtype)\n                return {"type": obj_type, "shape": shape, "dtype": dtype}\n            except:\n                return {"type": obj_type}\n\n        #\n        # Save code\n        #\n        def standalone_imsave(path, img):\n            def preprocess_for_png(img):\n                assert img.ndim >= 2 and img.ndim <= 3\n                has_alpha = img.ndim == 3 and img.shape[2] == 4\n                is_grayscale = img.ndim == 2 or (img.shape[2] == 1)\n\n                while img.ndim < 3:\n                    img = img[..., None]\n\n                if is_grayscale:\n                    img = np.concatenate((img, img, img), axis=2)\n                if not has_alpha:\n                    mask = np.full((*img.shape[:2], 1), 0xFF)\n                    img = np.concatenate((img, mask), axis=2)\n\n                return img.astype(np.ubyte)\n\n            # https://gist.github.com/campagnola/0fb74586d38ea1a86e99\n            def make_png(data):\n                import numpy as np\n                import zlib\n                import struct\n\n                assert data.dtype == np.ubyte\n                assert data.ndim == 3\n                assert data.shape[-1] == 4\n\n                # www.libpng.org/pub/png/spec/1.2/PNG-Structure.html\n                header = bytes.fromhex("89504e470d0a1a0a")  # header\n\n                def mkchunk(data, name):\n                    if isinstance(data, np.ndarray):\n                        size = data.nbytes\n                    else:\n                        size = len(data)\n                    chunk = np.empty(size + 12, dtype=np.ubyte)\n                    chunk.data[0:4] = struct.pack("!I", size)\n                    chunk.data[4:8] = name  # b\'CPXS\' # critical, public, standard, safe\n                    chunk.data[8 : 8 + size] = data\n                    chunk.data[-4:] = struct.pack("!I", zlib.crc32(chunk[4:-4]))\n                    return chunk\n\n                # www.libpng.org/pub/png/spec/1.2/PNG-Chunks.html#C.IHDR\n                ctyp = 0b0110  # alpha, color\n                h, w = data.shape[:2]\n                depth = data.itemsize * 8\n                ihdr = struct.pack("!IIBBBBB", w, h, depth, ctyp, 0, 0, 0)\n                c1 = mkchunk(ihdr, b"IHDR")\n\n                # www.libpng.org/pub/png/spec/1.2/PNG-Chunks.html#C.IDAT\n                idat = np.empty(\n                    (h, w * 4 + 1), dtype=np.ubyte\n                )  # insert filter byte at each scanline\n                idat[:, 1:] = data.reshape(h, w * 4)\n                idat[:, 0] = 0\n                c2 = mkchunk(zlib.compress(idat), b"IDAT")\n\n                c3 = mkchunk(np.empty((0,), dtype=np.ubyte), b"IEND")\n\n                # concatenate\n                lh = len(header)\n                png = np.empty(lh + c1.nbytes + c2.nbytes + c3.nbytes, dtype=np.ubyte)\n                png.data[:lh] = header\n                p = lh\n                for chunk in (c1, c2, c3):\n                    png[p : p + len(chunk)] = chunk\n                    p += chunk.nbytes\n\n                return png\n\n            with open(path, "wb") as fp:\n                fp.write(make_png(preprocess_for_png(img)))\n\n        def prepare_image(img, preprocess_method="normalize"):\n            img = np.asarray(img)\n            if img.dtype in (bool, np.bool_):\n                img = img.astype(np.uint8)\n            # if channel first, convert to channel last\n            if img.ndim == 3 and img.shape[0] <= 4 and img.shape[2] > 4:\n                img = img.transpose(1, 2, 0)\n            if preprocess_method == "skimage.img_as_ubyte":\n                try:\n                    from skimage import img_as_ubyte\n\n                    return img_as_ubyte(img)\n                except:\n                    return img\n            elif preprocess_method == "normalize":\n                img = img - img.min()\n                img = img / img.max()\n                img = img * 255\n                img = img.astype(np.uint8)\n                return img\n            else:\n                return img\n\n        def opencv_imsave(path, img):\n            import cv2\n\n            cv2.imwrite(path, img)\n\n        def imageio_imsave(path, img):\n            import imageio\n\n            imageio.imwrite(path, img)\n\n        def pillow_imsave(path, img):\n            from PIL import Image\n\n            img = Image.fromarray(img)\n            img.save(path)\n\n        options = {\n            "opencv": ("cv2", opencv_imsave),\n            "imageio": ("imageio", imageio_imsave),\n            "Pillow": ("PIL", pillow_imsave),\n            "Standalone": ("numpy", standalone_imsave),\n        }\n\n        def try_import(package):\n            import importlib\n            try:\n                return importlib.import_module(package)\n            except ImportError:\n                return None\n\n        def get_function(preferred=None):\n            save_function = None\n\n            if preferred is not None and preferred in options:\n                module_test, function = options[preferred]\n                module = try_import(module_test)\n                if module:\n                    return function\n\n            for name, (module_test, function) in options.items():\n                module = try_import(module_test)\n                if module:\n                    save_function = function\n                    break\n            return save_function\n\n        def save(path, img, backend, preprocess):\n            func = get_function(backend)\n            img = prepare_image(img, preprocess)\n            func(path, img)\n\n        return is_numpy_image, info, save\n\n    is_numpy_image, numpy_image_info, numpy_image_save = numpy()\nexcept:\n    pass\n'},3358:e=>{"use strict";e.exports='try:\n    import numpy as np\n    import PIL\n    import PIL.Image\n\n    def pillow():\n        def is_pillow_image(img):\n            try:\n                return isinstance(img, PIL.Image.Image)\n            except TypeError:\n                return False\n\n        def info(img):\n            obj_type = type(img).__name__\n            try:\n                img = np.asarray(img)\n                shape = str(img.shape)\n                dtype = str(img.dtype)\n                return {"type": obj_type, "shape": shape, "dtype": dtype}\n            except:\n                return {"type": obj_type}\n\n        def save(path, img, *args, **kwargs):\n            from PIL import Image\n            img.save(path)\n\n        return is_pillow_image, info, save\n\n    is_pillow_image, pillow_image_info, pillow_image_save = pillow()\nexcept:\n    def is_pillow_image(img):\n        return False\n    pass'},2244:e=>{"use strict";e.exports='try:\n    import numpy as np\n    import skimage.util\n    import skimage.io\n    from skimage import img_as_ubyte\n\n    def numpy_tensor():\n        def is_numpy_tensor(obj):\n            valid_channels = (1, 3, 4)\n            try:\n                is_valid = isinstance(obj, np.ndarray)\n                is_valid &= len(obj.shape) in (3, 4)\n                if len(obj.shape) == 3:\n                    pass\n                elif len(obj.shape) == 4:\n                    is_valid &= obj.shape[3] in valid_channels\n                return is_valid\n\n            except TypeError:\n                return False\n\n        def info(obj):\n            obj_type = type(obj).__name__\n            try:\n                obj = np.asarray(obj)\n                shape = str(obj.shape)\n                dtype = str(obj.dtype)\n                return {"type": obj_type, "shape": shape, "dtype": dtype}\n            except:\n                return {"type": obj_type}\n\n        def save(path, obj, normalize=True, pad=10, *args, **kwargs):\n            is_color = obj.ndim == 4\n            if is_color:\n                pad_value = (1.0,) * obj.shape[-1]\n            else:\n                pad_value = 1.0\n            montage = skimage.util.montage(\n                obj.copy(),  # avoid modifying the input object\n                fill=pad_value,\n                rescale_intensity=normalize,\n                padding_width=pad,\n                multichannel=is_color,\n            )\n            skimage.io.imsave(path, img_as_ubyte(montage), check_contrast=False)\n\n        return is_numpy_tensor, info, save\n\n    is_numpy_tensor, numpy_tensor_info, numpy_tensor_save = numpy_tensor()\nexcept:\n    pass\n'},7661:e=>{"use strict";e.exports='try:\n    from plotly.basedatatypes import BaseFigure\n\n    def plotly_figure():\n        def is_plotly_figure(obj):\n            try:\n                return isinstance(obj, BaseFigure)\n            except TypeError:\n                return False\n\n        def info(obj):\n            obj_type = type(obj).__name__\n            return {"type": obj_type}\n\n        def save(path, fig, *args, **kwargs):\n            fig.write_image(path)\n\n        return is_plotly_figure, info, save\n\n    is_plotly_figure, plotly_figure_info, plotly_figure_save = plotly_figure()\nexcept:\n    pass\n'},8140:e=>{"use strict";e.exports='def set_matplotlib_agg(to_set):\n    if to_set:\n        try:\n            import matplotlib\n            matplotlib.use(\'agg\')\n        except:\n            pass\n\ntry:\n\n    import matplotlib.pyplot as plt\n    def pyplot_figure():\n        def is_pyplot_figure(obj):\n            try:\n                return isinstance(obj, plt.Figure)\n            except TypeError:\n                return False\n\n        def info(obj):\n            obj_type = type(obj).__name__\n            return {"type": obj_type}\n\n        def save(path, fig, tight=False, dpi=150, *args, **kwargs):\n            if fig is None:\n                fig = plt.gcf()\n            if tight:\n                fig.tight_layout()\n            fig.savefig(path, dpi=dpi)\n\n        return is_pyplot_figure, info, save\n\n    is_pyplot_figure, pyplot_figure_info, pyplot_figure_save = pyplot_figure()\n\n    def pyplot_axes():\n        def is_pyplot_ax(obj):\n            try:\n                return isinstance(obj, plt.Axes)\n            except TypeError:\n                return False\n\n        def info(obj):\n            obj_type = type(obj).__name__\n            return {"type": obj_type}\n\n        def save(path, ax, tight=False, dpi=150, *args, **kwargs):\n            from matplotlib.transforms import Bbox\n\n            fig = ax.figure\n            if tight:\n                fig.tight_layout()\n            renderer = fig.canvas.get_renderer()\n            items = []\n            items += ax.get_xticklabels() + ax.get_yticklabels()\n            items += [ax, ax.title]\n            bbox = Bbox.union(\n                [item.get_window_extent(renderer=renderer) for item in items]\n            )\n            extent = bbox.transformed(fig.dpi_scale_trans.inverted())\n            fig.savefig(path, bbox_inches=extent, dpi=dpi)\n\n        return is_pyplot_ax, info, save\n\n    is_pyplot_ax, pyplot_ax_info, pyplot_ax_save = pyplot_axes()\nexcept:\n    pass\n'},102:e=>{"use strict";e.exports="import socket\nimport sys\nimport traceback\nimport struct\nimport numpy as np\n\nMIN_INT32 = np.iinfo(np.int32).min\nMAX_INT32 = np.iinfo(np.int32).max\nMIN_UINT32 = np.iinfo(np.uint32).min\nMAX_UINT32 = np.iinfo(np.uint32).max\nMIN_FLOAT32 = np.finfo(np.float32).min\nMAX_FLOAT32 = np.finfo(np.float32).max\n\nDATATYPE_64BIT = (\"int64\", \"uint64\", \"float64\")\nCORRESPONDING_32BIT_TYPE = {\n    \"int64\": np.int32,\n    \"uint64\": np.uint32,\n    \"float64\": np.float32,\n}\n\nCHUNK_SIZE = 4 * 1024  # 4KB\n\n# See webview/communication/protocol.ts for message format\nPythonSender = 0x02\n# MessageType \nPythonSendingObject = 0x01\n# ObjectType\nNumpyArray = 0x01\nExceptionObject = 0xff\n# ByteOrderType\nLittleEndian = 0x01\nBigEndian = 0x02\n# ArrayDataType\nUndefinedDatatype = 0x00\nFloat32 = 0x01\nFloat64 = 0x02\nInt8 = 0x03\nInt16 = 0x04\nInt32 = 0x05\nInt64 = 0x06\nUint8 = 0x07\nUint16 = 0x08\nUint32 = 0x09\nUint64 = 0x0a\nBool = 0x0b\n# DimensionOrder\nHWC = 0x01\nCHW = 0x02\n# ExceptionType\nExceptionTypes = {\n    BaseException: 0x01,\n    Exception: 0x02,\n    RuntimeError: 0x03,\n    TypeError: 0x04,\n    ValueError: 0x05,\n    None: 0xff,  # Unknown exception\n}\n\nMessageLengthType = np.uint32\nMessageIdType = np.uint32\nSenderType = np.uint8\nMessageType = np.uint8\nRequestIdType = np.uint32\nChunkCountType = np.uint32\nChunkIndexType = np.uint32\nChunkLengthType = np.uint32\n\nObjectIdType = np.uint32\nObjectType = np.uint8\nStringLengthType = np.uint32\nNumDimsType = np.uint8\nDimType = np.uint32\nByteOrderType = np.uint8\nStatsType = np.float32  \n\narray_dtype_to_array_data_type = {\n    \"float32\": Float32,\n    \"float64\": Float64,\n    \"int8\": Int8,\n    \"int16\": Int16,\n    \"int32\": Int32,\n    \"int64\": Int64,\n    \"uint8\": Uint8,\n    \"uint16\": Uint16,\n    \"uint32\": Uint32,\n    \"uint64\": Uint64,\n    \"bool\": Bool,\n    \"bool_\": Bool,\n}\n\nBYTE_ORDER = LittleEndian if sys.byteorder == 'little' else BigEndian\n\ndef generate_message_id():\n    rng = np.random.default_rng()\n    return rng.integers(0, 2**32, dtype=np.uint32)\n\ndef chunk_header(\n    message_length,\n    message_id,\n    request_id,\n    chunk_count,\n    chunk_index,\n    chunk_length,\n):\n    message_length = MessageLengthType(message_length)\n    message_id  = MessageIdType(message_id)\n    sender = SenderType(PythonSender)\n    request_id = RequestIdType(request_id)\n    message_type = MessageType(PythonSendingObject)\n    chunk_count = ChunkCountType(chunk_count)\n    chunk_index = ChunkIndexType(chunk_index)\n    chunk_length = ChunkLengthType(chunk_length)\n\n    # Create the message\n    header = [\n        message_length,\n        message_id,\n        sender,\n        request_id,\n        message_type,\n        chunk_count,\n        chunk_index,\n        chunk_length,\n    ]\n    # print({\n    #     'message_length': message_length,\n    #     'message_id': message_id,\n    #     'sender': sender,\n    #     'request_id': request_id,\n    #     'message_type': message_type,\n    #     'chunk_count': chunk_count,\n    #     'chunk_index': chunk_index,\n    #     'chunk_length': chunk_length,\n    # })\n    \n    # Create the message format string\n    header_format = f'!IIBIBIII'\n\n    return struct.pack(header_format, *header)\n\ndef is_64bit(array):\n    return str(array.dtype) in DATATYPE_64BIT\n\ndef check_can_fit_in_32bit(array_64bit):\n    corresponding_32bit_type = CORRESPONDING_32BIT_TYPE.get(str(array_64bit.dtype), None)\n    if corresponding_32bit_type is None:\n        return False\n    array_min = np.min(array_64bit)\n    array_max = np.max(array_64bit)\n    return array_min >= MIN_INT32 and array_max <= MAX_INT32\n\ndef guess_image_dimensions(image):\n    if not isinstance(image, np.ndarray):\n        return None\n    shape = image.shape\n\n    if len(shape) < 2:\n        return None\n\n    if len(shape) == 2:\n        return { 'width': DimType(shape[1]), 'height': DimType(shape[0]),'channels': DimType(1), 'order': HWC }\n\n    if len(shape) == 4 and shape[0] == 1:\n        # A batched image\n        image = image[0]\n\n    if len(shape) == 3:\n        if shape[2] > 4:\n            # Possibly a channel first image\n            if shape[0] > 4:\n                return None\n            return { 'width': DimType(shape[2]), 'height': DimType(shape[1]), 'channels': DimType(shape[0]), 'order': CHW }\n        else:\n            return { 'width': DimType(shape[1]), 'height': DimType(shape[0]), 'channels': DimType(shape[2]), 'order': HWC }\n\n    return None\n\ndef array_stats(array):\n    if not isinstance(array, np.ndarray):\n        return None\n    shape = array.shape\n    ndims = len(array.shape)\n\n    if ndims < 2:\n        return None\n    \n    if ndims == 2 or (ndims == 3 and shape[2] == 1):\n        return { 'min': [StatsType(np.nanmin(array))], 'max': [StatsType(np.nanmax(array))] }\n    \n    if ndims == 4 and shape[0] == 1:\n        # assume batched image\n        image = array[0]\n\n    if ndims == 3:\n        # per channel stats\n        if shape[2] > 4:\n            # Possibly a channel first image\n            if shape[0] > 4:\n                return None\n            return { 'min': StatsType(np.nanmin(array, axis=(1,2))), 'max': StatsType(np.nanmax(array, axis=(1,2))) }\n        else:\n            return { 'min': StatsType(np.nanmin(array, axis=(0,1))), 'max': StatsType(np.nanmax(array, axis=(0,1))) }\n\n    return None\n\n        \n\ndef create_numpy_message(\n    array: np.ndarray,\n):\n\n    object_type     = ObjectType(NumpyArray)\n    array_dtype     = array_dtype_to_array_data_type[str(array.dtype)]\n    actual_datatype = UndefinedDatatype\n    byte_order      = ByteOrderType(BYTE_ORDER)\n    num_dimensions  = NumDimsType(len(array.shape))\n    array_shape     = np.array(array.shape, dtype=DimType)\n\n    dimensions = guess_image_dimensions(array) or {}\n    w = dimensions.get('width', DimType(0))\n    h = dimensions.get('height', DimType(0))\n    c = dimensions.get('channels', DimType(0))\n    order = dimensions.get('order', None)\n\n    stats = array_stats(array) or {}\n    min_stats = stats.get('min', [])\n    max_stats = stats.get('max', [])\n    assert len(min_stats) == len(max_stats)\n    num_stats = len(min_stats)\n\n    # The webview only supports up to 32 bit integers and floats. If the array is 64 bit, try to convert it to 32 bit.\n    if is_64bit(array) and check_can_fit_in_32bit(array):\n        array = array.astype(CORRESPONDING_32BIT_TYPE[str(array.dtype)])\n        actual_datatype = array_dtype_to_array_data_type[str(array.dtype)]\n\n    array_data = array.tobytes('C')\n\n    metadata = [\n        object_type,\n        array_dtype,\n        actual_datatype,\n        byte_order,\n        num_dimensions,\n        *array_shape,\n        w,\n        h,\n        c,\n        order,\n        num_stats,\n        *min_stats,\n        *max_stats,\n    ]\n    \n    # add padding before the array data, making sure the offset is a multiple of the element size\n    # metadata_size = 1 + 1 + 1 + 1 + num_dimensions * 4\n    # bytes_per_element = array.dtype.itemsize\n    # message_length_placeholder = 4\n    # padding_size =  (bytes_per_element - (header_size + message_length_placeholder) % bytes_per_element) % bytes_per_element\n    # padding = bytes(padding_size)\n\n    message = [\n        *metadata,\n        array_data,\n    ]\n\n    # Create the message format string\n    message_format = f'!BBBBB{num_dimensions}IIIIBB{num_stats}f{num_stats}f{len(array_data)}s'\n\n    # Pack the message\n    message_pack = struct.pack(message_format, *message)\n\n    return message_pack\n\ndef create_pillow_message(\n    image,\n):\n    image_np = np.asarray(image)\n    return create_numpy_message(image_np)\n\ndef string_to_message(s):\n    length = StringLengthType(len(s))\n    bytes = s.encode()\n    return (length, bytes)\n\ndef create_exception_message(\n    exception: Exception,\n):\n    exception_type_name = getattr(type(exception), '__name__', 'Unknown')\n    exception_message = str(exception)\n\n    object_type = ObjectType(ExceptionObject)\n    (exception_type_length, exception_type) = string_to_message(exception_type_name)\n    (exception_message_length, exception_message) = string_to_message(exception_message)\n\n    message = [\n        object_type,\n        exception_type_length,\n        exception_type,\n        exception_message_length,\n        exception_message,\n    ]\n    \n    # Create the message format string\n    message_format = f'!BI{exception_type_length}sI{exception_message_length}s'\n\n    # Pack the message\n    message_pack = struct.pack(message_format, *message)\n\n    return message_pack\n\n\n    # Create the message body\n    exception_type = ExceptionTypes.get(type(exception), ExceptionTypes[None])\n    exception_message = traceback.format_exc().encode()\n    \n    # Create the message\n    message = [\n        message_type,\n        request_id,\n        object_id,\n        object_type,\n        exception_type,\n        exception_message,\n    ]\n\n    # Create the message format string\n    message_format = f'!BIIBB{len(exception_message)}s'\n\n    # Pack the message\n    message_pack = struct.pack(message_format, *message)\n\n    return message_pack\n\n\ndef message_chunks(\n    message_length,\n    message_id,\n    request_id,\n    message,\n):\n    loc = 0\n    chunk_count = len(message) // CHUNK_SIZE + 1\n    for chunk_index in range(chunk_count):\n        data = message[loc:loc+CHUNK_SIZE]\n        chunk_length = len(data)\n        header = chunk_header(\n            message_length,\n            message_id,\n            request_id,\n            chunk_count,\n            chunk_index,\n            chunk_length,\n        )\n        loc += CHUNK_SIZE\n        yield header + data\n\n\ndef open_send_and_close(port, request_id, obj):\n    with socket.socket(socket.AF_INET, socket.SOCK_STREAM) as s:\n        s.connect(('localhost', port))\n\n        try:\n            if isinstance(obj, np.ndarray):\n                message = create_numpy_message(obj)\n            elif is_pillow_image(obj):\n                message = create_pillow_message(obj)\n            else:\n                raise ValueError(f'Cant send object of type {type(obj)}')\n        except Exception as e:\n            message = create_exception_message(e)\n        \n        message_length = len(message)\n\n        # Send the message data\n        message_id = generate_message_id()\n        # print(f'Sending message {message_id}')\n        chunks = message_chunks(message_length, message_id, request_id, message)\n\n        all_data = b''\n\n        # Send the message\n        for chunk in chunks:\n            s.sendall(chunk)\n            all_data += chunk\n\n        # Close the socket\n        s.close()"},7694:e=>{"use strict";e.exports='try:\n    import torch\n\n    def torch_tensor():\n        def is_torch_tensor(obj):\n            valid_channels = (1, 2, 3, 4)\n            try:\n                is_valid = isinstance(obj, torch.Tensor)\n                is_valid &= len(obj.shape) in (2, 3, 4)\n                if len(obj.shape) == 2:\n                    pass\n                elif len(obj.shape) == 3:\n                    is_valid &= obj.shape[0] in valid_channels\n                elif len(obj.shape) == 4:\n                    is_valid &= obj.shape[1] in valid_channels\n                return is_valid\n            except:\n                return False\n\n        def info(obj):\n            obj_type = type(obj).__name__\n            try:\n                shape = str(tuple(obj.shape))\n                dtype = str(obj.dtype)\n                return {"type": obj_type, "shape": shape, "dtype": dtype}\n            except:\n                return {"type": obj_type}\n\n        def save(path, obj, normalize=True, pad=10, *args, **kwargs):\n            import torchvision\n\n            pad_value = 255\n            torchvision.utils.save_image(\n                obj.float(),\n                path,\n                normalize=normalize,\n                pad_value=pad_value,\n                padding=pad,\n            )\n\n        return is_torch_tensor, info, save\n\n    is_torch_tensor, torch_tensor_info, torch_tensor_save = torch_tensor()\nexcept:\n    pass'},9496:e=>{"use strict";e.exports=require("vscode")},7147:e=>{"use strict";e.exports=require("fs")},3292:e=>{"use strict";e.exports=require("fs/promises")},1808:e=>{"use strict";e.exports=require("net")},6005:e=>{"use strict";e.exports=require("node:crypto")},2037:e=>{"use strict";e.exports=require("os")},1017:e=>{"use strict";e.exports=require("path")}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var o=t[r]={exports:{}};return e[r].call(o.exports,o,o.exports,n),o.exports}n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r=n(112);module.exports=r})();
//# sourceMappingURL=extension.js.map